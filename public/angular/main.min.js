!function(){angular.module("assignments",[])}(),function(){angular.module("courses",[])}(),function(){angular.module("general",[])}(),angular.module("angularSlideables",[]).directive("slideable",function(){return{restrict:"C",compile:function(element,attr){var contents=element.html();return element.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+contents+"</div>"),function(scope,element,attrs){attrs.duration=attrs.duration?attrs.duration:"1s",attrs.easing=attrs.easing?attrs.easing:"ease-in-out",element.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:attrs.duration,transitionTimingFunction:attrs.easing})}}}}).directive("slideToggle",function(){return{restrict:"A",link:function(scope,element,attrs){var target,content;attrs.expanded=!1,element.bind("click",function(){if(target||(target=document.querySelector(attrs.slideToggle)),content||(content=target.querySelector(".slideable_content")),attrs.expanded)target.style.height="0px";else{content.style.border="1px solid rgba(0,0,0,0)";var y=content.clientHeight;content.style.border=0,target.style.height=y+"px"}attrs.expanded=!attrs.expanded})}}}),function(){angular.module("user",[]).run(["$http","UserFactory",function($http,UserFactory){$http.get("/api/profile").success(function(res){UserFactory.setUser(res)}).error(function(res){UserFactory.setUser({})})}])}(),function(){var app=angular.module("grader",["ui.router","general","courses","user","assignments"]);app.config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0)}]),app.run(["$rootScope","AuthService","AuthResolver",function($rootScope,AuthService,AuthResolver){$rootScope.$on("$stateChangeStart",function(event,next){AuthResolver.bIsResolved()?(console.log("stateChangeStart resolved"),console.log("auth: "+AuthService.isAuthenticated())):AuthResolver.resolve().then(function(data){console.log("stateChangeStart not resolved"),console.log("auth: "+AuthService.isAuthenticated())})})}])}(),function(){angular.module("assignments").controller("AssignmentController",["$stateParams","UserFactory","AssignmentFactory",function($stateParams,UserFactory,AssignmentFactory){var vm=this;vm.user=UserFactory.getUser(),vm.courseCode=$stateParams.courseCode,vm.assignmentID=$stateParams.assignmentID,vm.assignment={},vm.question={},vm.memes=1;var getAssignment=function(){AssignmentFactory.getAssignment(vm.courseCode,vm.assignmentID).then(function(assignment){vm.assignment=assignment},function(err){})};this.contentTracker=function(n){console.log(n)},this.addQuestion=function(){AssignmentFactory.addQuestion(vm.courseCode,vm.assignmentID).then(function(res){console.log(res.data)},function(res){})},this.editQuestion=function(question){question.questionIndex=0,AssignmentFactory.editQuestion(vm.courseCode,vm.assignmentID,question).then(function(res){console.log(res)},function(res){console.log(res)})},getAssignment()}])}(),function(){angular.module("assignments").directive("question",function(){return{restrict:"E",templateUrl:"/angular/assignments/partials/question.html"}})}(),function(){angular.module("assignments").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.assignment",{url:"/course/:courseCode/assignment/:assignmentID",templateUrl:"/angular/assignments/partials/assignment.html",controller:"AssignmentController",controllerAs:"assignmentCtrl"})}])}(),function(){angular.module("assignments").factory("AssignmentFactory",["$http",function($http){function createAssignment(courseCode,newAssignment){return $http.post("/api/course/"+courseCode+"/assignment/create",newAssignment)}function getAssignment(courseCode,assignmentID){return $http.get("/api/course/"+courseCode+"/assignment/"+assignmentID).then(function(res){var assignment=res.data,eI=0,qI=0;assignment.content=new Array(assignment.questions.length+assignment.exercises.length);for(var i=0;i<assignment.contentOrder.length;i++)assignment.contentOrder[i]?(assignment.content[i]=assignment.exercises[eI],assignment.content[i].type="exercise",eI++):(assignment.content[i]=assignment.questions[qI],assignment.content[i].type="question",qI++);return assignment},function(res){})}function addQuestion(courseCode,assignmentID){return $http.post("/api/course/"+courseCode+"/assignment/"+assignmentID+"/question/create")}function editQuestion(courseCode,assignmentID,question){return $http.put("/api/course/"+courseCode+"/assignment/"+assignmentID+"/question/edit",question)}return{createAssignment:createAssignment,getAssignment:getAssignment,addQuestion:addQuestion,editQuestion:editQuestion}}])}(),function(){angular.module("user").controller("DashboardController",["$state","$http","CourseFactory","UserFactory",function($state,$http,CourseFactory,UserFactory){var vm=this;this.newCourse={},this.courses=null,this.user=UserFactory.getUser();var getCourses=function(){CourseFactory.getCourses().then(function(res){vm.courses=res.data},function(res){})};this.createCourse=function(){CourseFactory.createCourse(vm.newCourse).then(function(res){console.log(res)})},getCourses()}]),angular.module("user").controller("CourseController",["$state","$http","$stateParams","UserFactory","CourseFactory","AssignmentFactory",function($state,$http,$stateParams,UserFactory,CourseFactory,AssignmentFactory){var vm=this;this.course=null,this.user=UserFactory.getUser(),this.newAssignment={};var getCourse=function(){CourseFactory.getCourse($stateParams.courseCode).then(function(res){console.log(res),vm.course=res.data,vm.newAssignment.courseID=res.data._id},function(res){})};this.createAssignment=function(){AssignmentFactory.createAssignment($stateParams.courseCode,vm.newAssignment).then(function(res){console.log(res)},function(res){})},getCourse()}])}(),function(){angular.module("user").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.main.dashboard",{templateUrl:"/angular/courses/partials/dashboard.html",controller:"DashboardController",controllerAs:"dashboardCtrl"}),$stateProvider.state("root.course",{url:"/course/:courseCode",templateUrl:"/angular/courses/partials/course.html",controller:"CourseController",controllerAs:"courseCtrl"})}])}(),function(){angular.module("courses").factory("CourseFactory",["$http",function($http){function createCourse(newCourse){return $http.post("/api/course/create",newCourse)}function getCourse(courseCode){return $http.get("/api/course/"+courseCode)}function getCourses(){return $http.get("/api/profile/courses")}return{createCourse:createCourse,getCourse:getCourse,getCourses:getCourses}}])}(),function(){angular.module("general").controller("NavController",["$http","AuthService","AuthResolver","$state",function($http,AuthService,AuthResolver,$state){var vm=this;this.$state=$state,this.bLoggedIn=null,AuthResolver.bIsResolved()?vm.bLoggedIn=AuthService.isAuthenticated():AuthResolver.resolve().then(function(){vm.bLoggedIn=AuthService.isAuthenticated()})}])}(),function(){angular.module("general").config(["$stateProvider",function($stateProvider){$stateProvider.state("root",{"abstract":!0,template:"<ui-view/>",resolve:{auth:["AuthResolver",function(AuthResolver){return AuthResolver.bIsResolved()===!0||AuthResolver.resolve()}]}}).state("root.main",{url:"/",template:"<ui-view/>",controller:["$state","AuthService",function($state,AuthService){AuthService.isAuthenticated()?$state.go("root.main.dashboard"):$state.go("root.main.public")}]}).state("root.main.public",{templateUrl:"/angular/general/partials/index.html",controller:function(){console.log("Hit public index")}})}])}(),function(){angular.module("user").controller("LoginController",["$state","$rootScope","AuthService",function($state,$rootScope,AuthService){var vm=this;this.authMessage="",this.user={email:"",password:""},this.login=function(){AuthService.login(root.user).then(function(res){$state.go("root.main")},function(res){vm.authMessage=res.data.userMessage})}}]),angular.module("user").controller("JoinController",["$state","$rootScope","AuthService",function($state,$rootScope,AuthService){var vm=this;this.authMessage="",this.user={firstName:"",lastName:"",retypePassword:"",password:"",email:"",accountType:""},this.signup=function(){AuthService.signup(root.user).then(function(res){$state.go("root.main")},function(res){vm.authMessage=res.data.userMessage})}}]),angular.module("user").controller("ProfileController",["$state","UserFactory",function($state,UserFactory){this.user=UserFactory.getUser()}])}(),function(){angular.module("user").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.login",{url:"/login",templateUrl:"/angular/user/partials/login.html",controller:"LoginController",controllerAs:"loginCtrl"}),$stateProvider.state("root.join",{url:"/join",templateUrl:"/angular/user/partials/join.html",controller:"JoinController",controllerAs:"joinCtrl"}),$stateProvider.state("root.profile",{url:"/profile",templateUrl:"/angular/user/partials/profile.html",controller:"ProfileController",controllerAs:"profileCtrl"})}])}(),function(){angular.module("user").factory("AuthService",["$http","UserFactory",function($http,UserFactory){function login(credentials){return $http.post("/auth/local",credentials).then(function(res){return UserFactory.setUser(res.data),res.data})}function signup(newUser){return $http.post("/api/user/join",newUser).then(function(res){return UserFactory.setUser(res.data),res.data},function(res){return res.data})}function isAuthenticated(){return UserFactory.live()}return{login:login,signup:signup,isAuthenticated:isAuthenticated}}]),angular.module("user").factory("UserFactory",["$rootScope",function($rootScope){function live(){return Object.keys($rootScope.currentUser).length>0}function setUser(user){$rootScope.currentUser=user}function getUser(){return $rootScope.currentUser}function destroyUser(){$rootScope.currentUser=null}return{live:live,setUser:setUser,getUser:getUser,destroyUser:destroyUser}}]),angular.module("user").factory("AuthResolver",["$q","$rootScope","$state",function($q,$rootScope,$state){var bIsResolved=!1;return{resolve:function(){var deferred=$q.defer(),unwatch=$rootScope.$watch("currentUser",function(currentUser){angular.isDefined(currentUser)&&(currentUser?deferred.resolve(currentUser):deferred.reject(),bIsResolved=!0,unwatch())});return deferred.promise},bIsResolved:function(){return bIsResolved}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2lnbm1lbnRzL2Fzc2lnbm1lbnRzLm1vZHVsZS5qcyIsImNvdXJzZXMvY291cnNlcy5tb2R1bGUuanMiLCJnZW5lcmFsL2dlbmVyYWwubW9kdWxlLmpzIiwibWlzYy9zbGlkZWFibGUubW9kdWxlLmpzIiwidXNlci91c2VyLm1vZHVsZS5qcyIsImNvcmUuanMiLCJhc3NpZ25tZW50cy9hc3NpZ25tZW50cy5jdHJsLmpzIiwiYXNzaWdubWVudHMvYXNzaWdubWVudHMuZGlyLmpzIiwiYXNzaWdubWVudHMvYXNzaWdubWVudHMuc3RhdGVzLmpzIiwiYXNzaWdubWVudHMvYXNzaWdubWVudHMuc3ZjLmpzIiwiY291cnNlcy9jb3Vyc2VzLmN0cmwuanMiLCJtYWluLm1pbi5qcyIsImNvdXJzZXMvY291cnNlcy5zdGF0ZXMuanMiLCJjb3Vyc2VzL2NvdXJzZXMuc3ZjLmpzIiwiZ2VuZXJhbC9nZW5lcmFsLmN0cmwuanMiLCJnZW5lcmFsL2dlbmVyYWwuc3RhdGVzLmpzIiwidXNlci91c2VyLmN0cmwuanMiLCJ1c2VyL3VzZXIuc3RhdGVzLmpzIiwidXNlci91c2VyLnN2Yy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJjb21waWxlIiwiZWxlbWVudCIsImF0dHIiLCJjb250ZW50cyIsImh0bWwiLCJzY29wZSIsImF0dHJzIiwiZHVyYXRpb24iLCJlYXNpbmciLCJjc3MiLCJvdmVyZmxvdyIsImhlaWdodCIsInRyYW5zaXRpb25Qcm9wZXJ0eSIsInRyYW5zaXRpb25EdXJhdGlvbiIsInRyYW5zaXRpb25UaW1pbmdGdW5jdGlvbiIsImxpbmsiLCJ0YXJnZXQiLCJjb250ZW50IiwiZXhwYW5kZWQiLCJiaW5kIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVUb2dnbGUiLCJzdHlsZSIsImJvcmRlciIsInkiLCJjbGllbnRIZWlnaHQiLCJydW4iLCIkaHR0cCIsIlVzZXJGYWN0b3J5IiwiZ2V0Iiwic3VjY2VzcyIsInJlcyIsInNldFVzZXIiLCJlcnJvciIsImFwcCIsImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiaHRtbDVNb2RlIiwiJHJvb3RTY29wZSIsIkF1dGhTZXJ2aWNlIiwiQXV0aFJlc29sdmVyIiwiJG9uIiwiZXZlbnQiLCJuZXh0IiwiYklzUmVzb2x2ZWQiLCJjb25zb2xlIiwibG9nIiwiaXNBdXRoZW50aWNhdGVkIiwicmVzb2x2ZSIsInRoZW4iLCJkYXRhIiwiY29udHJvbGxlciIsIiRzdGF0ZVBhcmFtcyIsIkFzc2lnbm1lbnRGYWN0b3J5Iiwidm0iLCJ0aGlzIiwidXNlciIsImdldFVzZXIiLCJjb3Vyc2VDb2RlIiwiYXNzaWdubWVudElEIiwiYXNzaWdubWVudCIsInF1ZXN0aW9uIiwibWVtZXMiLCJnZXRBc3NpZ25tZW50IiwiZXJyIiwiY29udGVudFRyYWNrZXIiLCJuIiwiYWRkUXVlc3Rpb24iLCJlZGl0UXVlc3Rpb24iLCJxdWVzdGlvbkluZGV4IiwidGVtcGxhdGVVcmwiLCIkc3RhdGVQcm92aWRlciIsInN0YXRlIiwidXJsIiwiY29udHJvbGxlckFzIiwiZmFjdG9yeSIsImNyZWF0ZUFzc2lnbm1lbnQiLCJuZXdBc3NpZ25tZW50IiwicG9zdCIsImVJIiwicUkiLCJBcnJheSIsInF1ZXN0aW9ucyIsImxlbmd0aCIsImV4ZXJjaXNlcyIsImkiLCJjb250ZW50T3JkZXIiLCJ0eXBlIiwicHV0IiwiJHN0YXRlIiwiQ291cnNlRmFjdG9yeSIsIm5ld0NvdXJzZSIsImNvdXJzZXMiLCJnZXRDb3Vyc2VzIiwiY3JlYXRlQ291cnNlIiwiY291cnNlIiwiZ2V0Q291cnNlIiwiY291cnNlSUQiLCJfaWQiLCJiTG9nZ2VkSW4iLCJhYnN0cmFjdCIsInRlbXBsYXRlIiwiYXV0aCIsImdvIiwiYXV0aE1lc3NhZ2UiLCJlbWFpbCIsInBhc3N3b3JkIiwibG9naW4iLCJyb290IiwidXNlck1lc3NhZ2UiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInJldHlwZVBhc3N3b3JkIiwiYWNjb3VudFR5cGUiLCJzaWdudXAiLCJjcmVkZW50aWFscyIsIm5ld1VzZXIiLCJsaXZlIiwiT2JqZWN0Iiwia2V5cyIsImN1cnJlbnRVc2VyIiwiZGVzdHJveVVzZXIiLCIkcSIsImRlZmVycmVkIiwiZGVmZXIiLCJ1bndhdGNoIiwiJHdhdGNoIiwiaXNEZWZpbmVkIiwicmVqZWN0IiwicHJvbWlzZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxxQkNEQSxXQUNBRCxRQUFBQyxPQUFBLGlCQ0RBLFdBQ0FELFFBQUFDLE9BQUEsaUJDREFELFFBQUFDLE9BQUEsd0JBQ0FDLFVBQUEsWUFBQSxXQUNBLE9BQ0FDLFNBQUEsSUFDQUMsUUFBQSxTQUFBQyxRQUFBQyxNQUVBLEdBQUFDLFVBQUFGLFFBQUFHLE1BR0EsT0FGQUgsU0FBQUcsS0FBQSxxRkFBQUQsU0FBQSxVQUVBLFNBQUFFLE1BQUFKLFFBQUFLLE9BRUFBLE1BQUFDLFNBQUFELE1BQUFDLFNBQUFELE1BQUFDLFNBQUEsS0FDQUQsTUFBQUUsT0FBQUYsTUFBQUUsT0FBQUYsTUFBQUUsT0FBQSxjQUNBUCxRQUFBUSxLQUNBQyxTQUFBLFNBQ0FDLE9BQUEsTUFDQUMsbUJBQUEsU0FDQUMsbUJBQUFQLE1BQUFDLFNBQ0FPLHlCQUFBUixNQUFBRSxjQU1BVixVQUFBLGNBQUEsV0FDQSxPQUNBQyxTQUFBLElBQ0FnQixLQUFBLFNBQUFWLE1BQUFKLFFBQUFLLE9BQ0EsR0FBQVUsUUFBQUMsT0FFQVgsT0FBQVksVUFBQSxFQUVBakIsUUFBQWtCLEtBQUEsUUFBQSxXQUlBLEdBSEFILFNBQUFBLE9BQUFJLFNBQUFDLGNBQUFmLE1BQUFnQixjQUNBTCxVQUFBQSxRQUFBRCxPQUFBSyxjQUFBLHVCQUVBZixNQUFBWSxTQU1BRixPQUFBTyxNQUFBWixPQUFBLFVBTkEsQ0FDQU0sUUFBQU0sTUFBQUMsT0FBQSx5QkFDQSxJQUFBQyxHQUFBUixRQUFBUyxZQUNBVCxTQUFBTSxNQUFBQyxPQUFBLEVBQ0FSLE9BQUFPLE1BQUFaLE9BQUFjLEVB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S0FwQkEsT0FDQUgsS0FBQUEsS0FDQXJGLFFBQUFBLFFBQ0F5QixRQUFBQSxRQUNBZ0UsWUFBQUEsZ0JBb0JBOUgsUUFBQUMsT0FBQSxRQUFBK0UsUUFBQSxnQkFBQSxLQUFBLGFBQUEsU0FBQSxTQUFBK0MsR0FBQXBGLFdBQUFtRCxRQUNBLEdBQUE3QyxjQUFBLENBRUEsUUFDQUksUUFBQSxXQUNBLEdBQUEyRSxVQUFBRCxHQUFBRSxRQUNBQyxRQUFBdkYsV0FBQXdGLE9BQUEsY0FBQSxTQUFBTixhQUNBN0gsUUFBQW9JLFVBQUFQLGVBQ0FBLFlBQ0FHLFNBQUEzRSxRQUFBd0UsYUFFQUcsU0FBQUssU0FFQXBGLGFBQUEsRUFDQWlGLFlBR0EsT0FBQUYsVUFBQU0sU0FHQXJGLFlBQUEsV0FDQSxNQUFBQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnLCBbXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjb3Vyc2VzJywgW10pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ2VuZXJhbCcsIFtdKTtcclxufSkoKTsiLCJhbmd1bGFyLm1vZHVsZSgnYW5ndWxhclNsaWRlYWJsZXMnLCBbXSlcclxuLmRpcmVjdGl2ZSgnc2xpZGVhYmxlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDonQycsXHJcbiAgICAgICAgY29tcGlsZTogZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHIpIHtcclxuICAgICAgICAgICAgLy8gd3JhcCB0YWdcclxuICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gZWxlbWVudC5odG1sKCk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuaHRtbCgnPGRpdiBjbGFzcz1cInNsaWRlYWJsZV9jb250ZW50XCIgc3R5bGU9XCJtYXJnaW46MCAhaW1wb3J0YW50OyBwYWRkaW5nOjAgIWltcG9ydGFudFwiID4nICsgY29udGVudHMgKyAnPC9kaXY+Jyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gcG9zdExpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgIGF0dHJzLmR1cmF0aW9uID0gKCFhdHRycy5kdXJhdGlvbikgPyAnMXMnIDogYXR0cnMuZHVyYXRpb247XHJcbiAgICAgICAgICAgICAgICBhdHRycy5lYXNpbmcgPSAoIWF0dHJzLmVhc2luZykgPyAnZWFzZS1pbi1vdXQnIDogYXR0cnMuZWFzaW5nO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgICdvdmVyZmxvdyc6ICdoaWRkZW4nLFxyXG4gICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnMHB4JyxcclxuICAgICAgICAgICAgICAgICAgICAndHJhbnNpdGlvblByb3BlcnR5JzogJ2hlaWdodCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zaXRpb25EdXJhdGlvbic6IGF0dHJzLmR1cmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uVGltaW5nRnVuY3Rpb24nOiBhdHRycy5lYXNpbmdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pXHJcbi5kaXJlY3RpdmUoJ3NsaWRlVG9nZ2xlJywgZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQsIGNvbnRlbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhdHRycy5leHBhbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXR0cnMuc2xpZGVUb2dnbGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb250ZW50KSBjb250ZW50ID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZWFibGVfY29udGVudCcpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZighYXR0cnMuZXhwYW5kZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgcmdiYSgwLDAsMCwwKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjb250ZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmJvcmRlciA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IHkgKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc3R5bGUuaGVpZ2h0ID0gJzBweCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdHRycy5leHBhbmRlZCA9ICFhdHRycy5leHBhbmRlZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTsiLCIoZnVuY3Rpb24oKXtcclxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ3VzZXInLCBbXSlcclxuXHQucnVuKGZ1bmN0aW9uKCRodHRwLCBVc2VyRmFjdG9yeSl7XHJcblx0XHQkaHR0cC5nZXQoJy9hcGkvcHJvZmlsZScpXHJcblx0XHQuc3VjY2VzcyhmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHJlcyk7XHJcblx0XHR9KVxyXG5cdFx0LmVycm9yKGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFVzZXJGYWN0b3J5LnNldFVzZXIoe30pO1xyXG5cdFx0fSk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdncmFkZXInLCBcclxuXHRcdFtcclxuXHRcdFx0J3VpLnJvdXRlcicsXHJcblx0XHRcdCdnZW5lcmFsJyxcclxuXHRcdFx0J2NvdXJzZXMnLFxyXG5cdFx0XHQndXNlcicsXHJcblx0XHRcdCdhc3NpZ25tZW50cydcclxuXHRcdF0pO1xyXG5cclxuXHQvL3JlbW92ZSB0aGUgaGFzaFxyXG5cdGFwcC5jb25maWcoWyckbG9jYXRpb25Qcm92aWRlcicsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyKXtcclxuXHRcdCRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHR9XSk7XHJcblx0XHJcblx0YXBwLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UsIEF1dGhSZXNvbHZlcikge1xyXG4gIFx0XHQkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIG5leHQpIHtcclxuICBcdFx0XHRpZiAoQXV0aFJlc29sdmVyLmJJc1Jlc29sdmVkKCkpe1xyXG4gIFx0XHRcdFx0Y29uc29sZS5sb2coJ3N0YXRlQ2hhbmdlU3RhcnQgcmVzb2x2ZWQnKTtcclxuICBcdFx0XHRcdGNvbnNvbGUubG9nKCdhdXRoOiAnICsgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpO1xyXG4gIFx0XHRcdH1lbHNle1xyXG4gIFx0XHRcdFx0QXV0aFJlc29sdmVyLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xyXG4gIFx0XHRcdFx0XHRjb25zb2xlLmxvZygnc3RhdGVDaGFuZ2VTdGFydCBub3QgcmVzb2x2ZWQnKTtcclxuICBcdFx0XHRcdFx0Y29uc29sZS5sb2coJ2F1dGg6ICcgKyBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSk7XHJcbiAgXHRcdFx0XHR9KVxyXG4gIFx0XHRcdH1cclxuICBcdFx0fSk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJykuY29udHJvbGxlcignQXNzaWdubWVudENvbnRyb2xsZXInLCBmdW5jdGlvbigkc3RhdGVQYXJhbXMsIFVzZXJGYWN0b3J5LCBBc3NpZ25tZW50RmFjdG9yeSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dm0udXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHRcdHZtLmNvdXJzZUNvZGUgPSAkc3RhdGVQYXJhbXMuY291cnNlQ29kZTtcclxuXHRcdHZtLmFzc2lnbm1lbnRJRCA9ICRzdGF0ZVBhcmFtcy5hc3NpZ25tZW50SUQ7XHJcblx0XHR2bS5hc3NpZ25tZW50ID0ge307XHJcblx0XHR2bS5xdWVzdGlvbiA9IHt9O1xyXG5cclxuXHRcdHZtLm1lbWVzID0gMTtcclxuXHJcblx0XHR2YXIgZ2V0QXNzaWdubWVudCA9IGZ1bmN0aW9uKCl7XHJcbiBcdFx0XHRBc3NpZ25tZW50RmFjdG9yeS5nZXRBc3NpZ25tZW50KHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKGFzc2lnbm1lbnQpe1xyXG5cdFx0XHRcdFx0dm0uYXNzaWdubWVudCA9IGFzc2lnbm1lbnQ7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbiBGYWlsdXJlKGVycil7XHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0KVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY29udGVudFRyYWNrZXIgPSBmdW5jdGlvbihuKXtcclxuXHRcdFx0Y29uc29sZS5sb2cobik7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdEFzc2lnbm1lbnRGYWN0b3J5LmFkZFF1ZXN0aW9uKHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMuZGF0YSlcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5lZGl0UXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbil7XHJcblx0XHRcdHF1ZXN0aW9uLnF1ZXN0aW9uSW5kZXggPSAwO1xyXG5cdFx0XHRBc3NpZ25tZW50RmFjdG9yeS5lZGl0UXVlc3Rpb24odm0uY291cnNlQ29kZSwgdm0uYXNzaWdubWVudElELCBxdWVzdGlvbikudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdClcclxuXHRcdH1cclxuXHJcblx0XHRnZXRBc3NpZ25tZW50KCk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJylcclxuXHQuZGlyZWN0aXZlKCdxdWVzdGlvbicsIGZ1bmN0aW9uKCl7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRyZXN0cmljdDogJ0UnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2Fzc2lnbm1lbnRzL3BhcnRpYWxzL3F1ZXN0aW9uLmh0bWwnXHJcblx0XHR9XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5hc3NpZ25tZW50Jywge1xyXG5cdFx0XHR1cmw6ICcvY291cnNlLzpjb3Vyc2VDb2RlL2Fzc2lnbm1lbnQvOmFzc2lnbm1lbnRJRCcsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvYXNzaWdubWVudHMvcGFydGlhbHMvYXNzaWdubWVudC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0Fzc2lnbm1lbnRDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnYXNzaWdubWVudEN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJykuZmFjdG9yeSgnQXNzaWdubWVudEZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0Y3JlYXRlQXNzaWdubWVudDogY3JlYXRlQXNzaWdubWVudCxcclxuXHRcdFx0Z2V0QXNzaWdubWVudDogZ2V0QXNzaWdubWVudCxcclxuXHRcdFx0YWRkUXVlc3Rpb246IGFkZFF1ZXN0aW9uLFxyXG5cdFx0XHRlZGl0UXVlc3Rpb246IGVkaXRRdWVzdGlvblxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBjcmVhdGVBc3NpZ25tZW50KGNvdXJzZUNvZGUsIG5ld0Fzc2lnbm1lbnQpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvY3JlYXRlJywgbmV3QXNzaWdubWVudCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldEFzc2lnbm1lbnQoY291cnNlQ29kZSwgYXNzaWdubWVudElEKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGFzc2lnbm1lbnQgPSByZXMuZGF0YTtcclxuXHRcdFx0XHRcdHZhciBlSSA9IDAsIHFJID0gMDtcclxuXHJcblx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnQgPSBuZXcgQXJyYXkoYXNzaWdubWVudC5xdWVzdGlvbnMubGVuZ3RoICsgYXNzaWdubWVudC5leGVyY2lzZXMubGVuZ3RoKTtcclxuXHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGFzc2lnbm1lbnQuY29udGVudE9yZGVyLmxlbmd0aDsgaSsrKXtcclxuXHRcdFx0XHRcdFx0Ly90cnVlID0gZXhlcmNpc2UsIGZhbHNlID0gcXVlc3Rpb25cclxuXHRcdFx0XHRcdFx0aWYgKGFzc2lnbm1lbnQuY29udGVudE9yZGVyW2ldKXtcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0gPSBhc3NpZ25tZW50LmV4ZXJjaXNlc1tlSV07XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldLnR5cGUgPSAnZXhlcmNpc2UnO1xyXG5cdFx0XHRcdFx0XHRcdGVJKys7XHJcblx0XHRcdFx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXSA9IGFzc2lnbm1lbnQucXVlc3Rpb25zW3FJXTtcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0udHlwZSA9ICdxdWVzdGlvbic7XHJcblx0XHRcdFx0XHRcdFx0cUkrK1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRyZXR1cm4gYXNzaWdubWVudDtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBhZGRRdWVzdGlvbihjb3Vyc2VDb2RlLCBhc3NpZ25tZW50SUQpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCArICcvcXVlc3Rpb24vY3JlYXRlJyk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gZWRpdFF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCwgcXVlc3Rpb24pe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEICsgJy9xdWVzdGlvbi9lZGl0JywgcXVlc3Rpb24pO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzdGF0ZSwgJGh0dHAsIENvdXJzZUZhY3RvcnksIFVzZXJGYWN0b3J5KXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR0aGlzLm5ld0NvdXJzZSA9IHt9O1xyXG5cdFx0dGhpcy5jb3Vyc2VzID0gbnVsbDtcclxuXHRcdHRoaXMudXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHJcblx0XHR2YXIgZ2V0Q291cnNlcyA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdENvdXJzZUZhY3RvcnkuZ2V0Q291cnNlcygpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0dm0uY291cnNlcyA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmNyZWF0ZUNvdXJzZSA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdENvdXJzZUZhY3RvcnkuY3JlYXRlQ291cnNlKHZtLm5ld0NvdXJzZSkudGhlbihmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGdldENvdXJzZXMoKTtcclxuXHR9KTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdDb3Vyc2VDb250cm9sbGVyJywgXHJcblx0XHRmdW5jdGlvbigkc3RhdGUsICRodHRwLCAkc3RhdGVQYXJhbXMsIFVzZXJGYWN0b3J5LCBDb3Vyc2VGYWN0b3J5LCBBc3NpZ25tZW50RmFjdG9yeSl7XHJcblxyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmNvdXJzZSA9IG51bGw7XHJcblx0XHR0aGlzLnVzZXIgPSBVc2VyRmFjdG9yeS5nZXRVc2VyKCk7XHJcblx0XHR0aGlzLm5ld0Fzc2lnbm1lbnQgPSB7fTtcclxuXHJcblx0XHR2YXIgZ2V0Q291cnNlID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5nZXRDb3Vyc2UoJHN0YXRlUGFyYW1zLmNvdXJzZUNvZGUpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0XHRcdHZtLmNvdXJzZSA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdFx0dm0ubmV3QXNzaWdubWVudC5jb3Vyc2VJRCA9IHJlcy5kYXRhLl9pZDtcclxuXHRcdFx0XHR9LCBcclxuXHRcdFx0XHRmdW5jdGlvbiBGYWlsdXJlKHJlcyl7XHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0KTtcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5jcmVhdGVBc3NpZ25tZW50ID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuY3JlYXRlQXNzaWdubWVudCgkc3RhdGVQYXJhbXMuY291cnNlQ29kZSwgdm0ubmV3QXNzaWdubWVudCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGdldENvdXJzZSgpO1xyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnLCBbXSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NvdXJzZXMnLCBbXSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2dlbmVyYWwnLCBbXSk7XHJcbn0pKCk7XG5hbmd1bGFyLm1vZHVsZSgnYW5ndWxhclNsaWRlYWJsZXMnLCBbXSlcclxuLmRpcmVjdGl2ZSgnc2xpZGVhYmxlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDonQycsXHJcbiAgICAgICAgY29tcGlsZTogZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHIpIHtcclxuICAgICAgICAgICAgLy8gd3JhcCB0YWdcclxuICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gZWxlbWVudC5odG1sKCk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuaHRtbCgnPGRpdiBjbGFzcz1cInNsaWRlYWJsZV9jb250ZW50XCIgc3R5bGU9XCJtYXJnaW46MCAhaW1wb3J0YW50OyBwYWRkaW5nOjAgIWltcG9ydGFudFwiID4nICsgY29udGVudHMgKyAnPC9kaXY+Jyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gcG9zdExpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgIGF0dHJzLmR1cmF0aW9uID0gKCFhdHRycy5kdXJhdGlvbikgPyAnMXMnIDogYXR0cnMuZHVyYXRpb247XHJcbiAgICAgICAgICAgICAgICBhdHRycy5lYXNpbmcgPSAoIWF0dHJzLmVhc2luZykgPyAnZWFzZS1pbi1vdXQnIDogYXR0cnMuZWFzaW5nO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgICdvdmVyZmxvdyc6ICdoaWRkZW4nLFxyXG4gICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnMHB4JyxcclxuICAgICAgICAgICAgICAgICAgICAndHJhbnNpdGlvblByb3BlcnR5JzogJ2hlaWdodCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zaXRpb25EdXJhdGlvbic6IGF0dHJzLmR1cmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uVGltaW5nRnVuY3Rpb24nOiBhdHRycy5lYXNpbmdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pXHJcbi5kaXJlY3RpdmUoJ3NsaWRlVG9nZ2xlJywgZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQsIGNvbnRlbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhdHRycy5leHBhbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXR0cnMuc2xpZGVUb2dnbGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb250ZW50KSBjb250ZW50ID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZWFibGVfY29udGVudCcpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZighYXR0cnMuZXhwYW5kZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgcmdiYSgwLDAsMCwwKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjb250ZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmJvcmRlciA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLmhlaWdodCA9IHkgKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc3R5bGUuaGVpZ2h0ID0gJzBweCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdHRycy5leHBhbmRlZCA9ICFhdHRycy5leHBhbmRlZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgndXNlcicsIFtdKVxyXG5cdC5ydW4oW1wiJGh0dHBcIiwgXCJVc2VyRmFjdG9yeVwiLCBmdW5jdGlvbigkaHR0cCwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0JGh0dHAuZ2V0KCcvYXBpL3Byb2ZpbGUnKVxyXG5cdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0VXNlckZhY3Rvcnkuc2V0VXNlcihyZXMpO1xyXG5cdFx0fSlcclxuXHRcdC5lcnJvcihmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHt9KTtcclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ3JhZGVyJywgXHJcblx0XHRbXHJcblx0XHRcdCd1aS5yb3V0ZXInLFxyXG5cdFx0XHQnZ2VuZXJhbCcsXHJcblx0XHRcdCdjb3Vyc2VzJyxcclxuXHRcdFx0J3VzZXInLFxyXG5cdFx0XHQnYXNzaWdubWVudHMnXHJcblx0XHRdKTtcclxuXHJcblx0Ly9yZW1vdmUgdGhlIGhhc2hcclxuXHRhcHAuY29uZmlnKFsnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlcil7XHJcblx0XHQkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblx0fV0pO1xyXG5cdFxyXG5cdGFwcC5ydW4oW1wiJHJvb3RTY29wZVwiLCBcIkF1dGhTZXJ2aWNlXCIsIFwiQXV0aFJlc29sdmVyXCIsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBBdXRoU2VydmljZSwgQXV0aFJlc29sdmVyKSB7XHJcbiAgXHRcdCRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCkge1xyXG4gIFx0XHRcdGlmIChBdXRoUmVzb2x2ZXIuYklzUmVzb2x2ZWQoKSl7XHJcbiAgXHRcdFx0XHRjb25zb2xlLmxvZygnc3RhdGVDaGFuZ2VTdGFydCByZXNvbHZlZCcpO1xyXG4gIFx0XHRcdFx0Y29uc29sZS5sb2coJ2F1dGg6ICcgKyBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSk7XHJcbiAgXHRcdFx0fWVsc2V7XHJcbiAgXHRcdFx0XHRBdXRoUmVzb2x2ZXIucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XHJcbiAgXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdzdGF0ZUNoYW5nZVN0YXJ0IG5vdCByZXNvbHZlZCcpO1xyXG4gIFx0XHRcdFx0XHRjb25zb2xlLmxvZygnYXV0aDogJyArIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKTtcclxuICBcdFx0XHRcdH0pXHJcbiAgXHRcdFx0fVxyXG4gIFx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKS5jb250cm9sbGVyKCdBc3NpZ25tZW50Q29udHJvbGxlcicsIFtcIiRzdGF0ZVBhcmFtc1wiLCBcIlVzZXJGYWN0b3J5XCIsIFwiQXNzaWdubWVudEZhY3RvcnlcIiwgZnVuY3Rpb24oJHN0YXRlUGFyYW1zLCBVc2VyRmFjdG9yeSwgQXNzaWdubWVudEZhY3Rvcnkpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHZtLnVzZXIgPSBVc2VyRmFjdG9yeS5nZXRVc2VyKCk7XHJcblx0XHR2bS5jb3Vyc2VDb2RlID0gJHN0YXRlUGFyYW1zLmNvdXJzZUNvZGU7XHJcblx0XHR2bS5hc3NpZ25tZW50SUQgPSAkc3RhdGVQYXJhbXMuYXNzaWdubWVudElEO1xyXG5cdFx0dm0uYXNzaWdubWVudCA9IHt9O1xyXG5cdFx0dm0ucXVlc3Rpb24gPSB7fTtcclxuXHJcblx0XHR2bS5tZW1lcyA9IDE7XHJcblxyXG5cdFx0dmFyIGdldEFzc2lnbm1lbnQgPSBmdW5jdGlvbigpe1xyXG4gXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuZ2V0QXNzaWdubWVudCh2bS5jb3Vyc2VDb2RlLCB2bS5hc3NpZ25tZW50SUQpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2Vzcyhhc3NpZ25tZW50KXtcclxuXHRcdFx0XHRcdHZtLmFzc2lnbm1lbnQgPSBhc3NpZ25tZW50O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShlcnIpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdClcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmNvbnRlbnRUcmFja2VyID0gZnVuY3Rpb24obil7XHJcblx0XHRcdGNvbnNvbGUubG9nKG4pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRBc3NpZ25tZW50RmFjdG9yeS5hZGRRdWVzdGlvbih2bS5jb3Vyc2VDb2RlLCB2bS5hc3NpZ25tZW50SUQpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzLmRhdGEpXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbiBGYWlsdXJlKHJlcyl7XHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0KVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZWRpdFF1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pe1xyXG5cdFx0XHRxdWVzdGlvbi5xdWVzdGlvbkluZGV4ID0gMDtcclxuXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuZWRpdFF1ZXN0aW9uKHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCwgcXVlc3Rpb24pLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0QXNzaWdubWVudCgpO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdhc3NpZ25tZW50cycpXHJcblx0LmRpcmVjdGl2ZSgncXVlc3Rpb24nLCBmdW5jdGlvbigpe1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzdHJpY3Q6ICdFJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9hc3NpZ25tZW50cy9wYXJ0aWFscy9xdWVzdGlvbi5odG1sJ1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5hc3NpZ25tZW50Jywge1xyXG5cdFx0XHR1cmw6ICcvY291cnNlLzpjb3Vyc2VDb2RlL2Fzc2lnbm1lbnQvOmFzc2lnbm1lbnRJRCcsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvYXNzaWdubWVudHMvcGFydGlhbHMvYXNzaWdubWVudC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0Fzc2lnbm1lbnRDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnYXNzaWdubWVudEN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKS5mYWN0b3J5KCdBc3NpZ25tZW50RmFjdG9yeScsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjcmVhdGVBc3NpZ25tZW50OiBjcmVhdGVBc3NpZ25tZW50LFxyXG5cdFx0XHRnZXRBc3NpZ25tZW50OiBnZXRBc3NpZ25tZW50LFxyXG5cdFx0XHRhZGRRdWVzdGlvbjogYWRkUXVlc3Rpb24sXHJcblx0XHRcdGVkaXRRdWVzdGlvbjogZWRpdFF1ZXN0aW9uXHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGNyZWF0ZUFzc2lnbm1lbnQoY291cnNlQ29kZSwgbmV3QXNzaWdubWVudCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC9jcmVhdGUnLCBuZXdBc3NpZ25tZW50KTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0QXNzaWdubWVudChjb3Vyc2VDb2RlLCBhc3NpZ25tZW50SUQpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHJcblx0XHRcdFx0XHR2YXIgYXNzaWdubWVudCA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdFx0dmFyIGVJID0gMCwgcUkgPSAwO1xyXG5cclxuXHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudCA9IG5ldyBBcnJheShhc3NpZ25tZW50LnF1ZXN0aW9ucy5sZW5ndGggKyBhc3NpZ25tZW50LmV4ZXJjaXNlcy5sZW5ndGgpO1xyXG5cclxuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYXNzaWdubWVudC5jb250ZW50T3JkZXIubGVuZ3RoOyBpKyspe1xyXG5cdFx0XHRcdFx0XHQvL3RydWUgPSBleGVyY2lzZSwgZmFsc2UgPSBxdWVzdGlvblxyXG5cdFx0XHRcdFx0XHRpZiAoYXNzaWdubWVudC5jb250ZW50T3JkZXJbaV0pe1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXSA9IGFzc2lnbm1lbnQuZXhlcmNpc2VzW2VJXTtcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0udHlwZSA9ICdleGVyY2lzZSc7XHJcblx0XHRcdFx0XHRcdFx0ZUkrKztcclxuXHRcdFx0XHRcdFx0fWVsc2V7XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldID0gYXNzaWdubWVudC5xdWVzdGlvbnNbcUldO1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXS50eXBlID0gJ3F1ZXN0aW9uJztcclxuXHRcdFx0XHRcdFx0XHRxSSsrXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJldHVybiBhc3NpZ25tZW50O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGFkZFF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEICsgJy9xdWVzdGlvbi9jcmVhdGUnKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBlZGl0UXVlc3Rpb24oY291cnNlQ29kZSwgYXNzaWdubWVudElELCBxdWVzdGlvbil7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wdXQoJy9hcGkvY291cnNlLycgKyBjb3Vyc2VDb2RlICsgJy9hc3NpZ25tZW50LycgKyBhc3NpZ25tZW50SUQgKyAnL3F1ZXN0aW9uL2VkaXQnLCBxdWVzdGlvbik7XHJcblx0XHR9XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgW1wiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCJDb3Vyc2VGYWN0b3J5XCIsIFwiVXNlckZhY3RvcnlcIiwgZnVuY3Rpb24oJHN0YXRlLCAkaHR0cCwgQ291cnNlRmFjdG9yeSwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHRoaXMubmV3Q291cnNlID0ge307XHJcblx0XHR0aGlzLmNvdXJzZXMgPSBudWxsO1xyXG5cdFx0dGhpcy51c2VyID0gVXNlckZhY3RvcnkuZ2V0VXNlcigpO1xyXG5cclxuXHRcdHZhciBnZXRDb3Vyc2VzID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5nZXRDb3Vyc2VzKCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHR2bS5jb3Vyc2VzID0gcmVzLmRhdGE7XHJcblx0XHRcdFx0fSwgXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuY3JlYXRlQ291cnNlID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5jcmVhdGVDb3Vyc2Uodm0ubmV3Q291cnNlKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0Q291cnNlcygpO1xyXG5cdH1dKTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdDb3Vyc2VDb250cm9sbGVyJywgXHJcblx0XHRbXCIkc3RhdGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIlVzZXJGYWN0b3J5XCIsIFwiQ291cnNlRmFjdG9yeVwiLCBcIkFzc2lnbm1lbnRGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzdGF0ZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgVXNlckZhY3RvcnksIENvdXJzZUZhY3RvcnksIEFzc2lnbm1lbnRGYWN0b3J5KXtcclxuXHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuY291cnNlID0gbnVsbDtcclxuXHRcdHRoaXMudXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHRcdHRoaXMubmV3QXNzaWdubWVudCA9IHt9O1xyXG5cclxuXHRcdHZhciBnZXRDb3Vyc2UgPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRDb3Vyc2VGYWN0b3J5LmdldENvdXJzZSgkc3RhdGVQYXJhbXMuY291cnNlQ29kZSkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdFx0dm0uY291cnNlID0gcmVzLmRhdGE7XHJcblx0XHRcdFx0XHR2bS5uZXdBc3NpZ25tZW50LmNvdXJzZUlEID0gcmVzLmRhdGEuX2lkO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmNyZWF0ZUFzc2lnbm1lbnQgPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRBc3NpZ25tZW50RmFjdG9yeS5jcmVhdGVBc3NpZ25tZW50KCRzdGF0ZVBhcmFtcy5jb3Vyc2VDb2RlLCB2bS5uZXdBc3NpZ25tZW50KS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdFx0fSwgXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0Q291cnNlKCk7XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHRcdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdyb290Lm1haW4uZGFzaGJvYXJkJywge1xyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2NvdXJzZXMvcGFydGlhbHMvZGFzaGJvYXJkLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnRGFzaGJvYXJkQ29udHJvbGxlcicsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ2Rhc2hib2FyZEN0cmwnXHJcblx0XHR9KTtcclxuXHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5jb3Vyc2UnLCB7XHJcblx0XHRcdHVybDogJy9jb3Vyc2UvOmNvdXJzZUNvZGUnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2NvdXJzZXMvcGFydGlhbHMvY291cnNlLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnQ291cnNlQ29udHJvbGxlcicsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ2NvdXJzZUN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnY291cnNlcycpLmZhY3RvcnkoJ0NvdXJzZUZhY3RvcnknLCBbXCIkaHR0cFwiLCBmdW5jdGlvbiAoJGh0dHApIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGNyZWF0ZUNvdXJzZTogY3JlYXRlQ291cnNlLFxyXG5cdFx0XHRnZXRDb3Vyc2U6IGdldENvdXJzZSxcclxuXHRcdFx0Z2V0Q291cnNlczogZ2V0Q291cnNlc1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGNyZWF0ZUNvdXJzZShuZXdDb3Vyc2UpIHtcclxuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvY291cnNlL2NyZWF0ZScsIG5ld0NvdXJzZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldENvdXJzZShjb3Vyc2VDb2RlKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGdldENvdXJzZXMoKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wcm9maWxlL2NvdXJzZXMnKTtcclxuXHRcdH1cclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnZ2VuZXJhbCcpLmNvbnRyb2xsZXIoJ05hdkNvbnRyb2xsZXInLCBbXCIkaHR0cFwiLCBcIkF1dGhTZXJ2aWNlXCIsIFwiQXV0aFJlc29sdmVyXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoU2VydmljZSwgQXV0aFJlc29sdmVyLCAkc3RhdGUpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHRoaXMuJHN0YXRlID0gJHN0YXRlO1xyXG5cdFx0dGhpcy5iTG9nZ2VkSW4gPSBudWxsO1xyXG5cdFx0XHJcblx0XHRpZiAoQXV0aFJlc29sdmVyLmJJc1Jlc29sdmVkKCkpe1xyXG5cdFx0XHR2bS5iTG9nZ2VkSW4gPSBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKTtcclxuXHRcdH1lbHNle1xyXG5cdFx0XHRBdXRoUmVzb2x2ZXIucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKXtcclxuXHRcdFx0XHR2bS5iTG9nZ2VkSW4gPSBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2dlbmVyYWwnKS5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIpe1xyXG5cclxuXHRcdCRzdGF0ZVByb3ZpZGVyXHJcblx0XHQuc3RhdGUoJ3Jvb3QnLCB7XHJcblx0XHRcdGFic3RyYWN0OiB0cnVlLFxyXG5cdFx0XHR0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nLFxyXG5cdFx0XHRyZXNvbHZlOiB7XHJcblx0XHRcdFx0YXV0aDogW1wiQXV0aFJlc29sdmVyXCIsIGZ1bmN0aW9uIHJlc29sdmVBdXRoZW50aWNhdGlvbihBdXRoUmVzb2x2ZXIpIHsgXHJcblx0XHRcdFx0XHRyZXR1cm4gKEF1dGhSZXNvbHZlci5iSXNSZXNvbHZlZCgpID09PSB0cnVlIHx8IEF1dGhSZXNvbHZlci5yZXNvbHZlKCkpO1xyXG5cdFx0XHRcdH1dXHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0LnN0YXRlKCdyb290Lm1haW4nLCB7XHJcblx0XHRcdHVybDogJy8nLFxyXG5cdFx0XHR0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nLFxyXG5cdFx0XHRjb250cm9sbGVyOiBbXCIkc3RhdGVcIiwgXCJBdXRoU2VydmljZVwiLCBmdW5jdGlvbigkc3RhdGUsIEF1dGhTZXJ2aWNlKXtcclxuXHRcdFx0XHRpZiAoQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpe1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4uZGFzaGJvYXJkJyk7XHJcblx0XHRcdFx0fWVsc2V7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbi5wdWJsaWMnKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1dXHJcblx0XHR9KVxyXG5cclxuXHRcdC5zdGF0ZSgncm9vdC5tYWluLnB1YmxpYycsIHtcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9nZW5lcmFsL3BhcnRpYWxzL2luZGV4Lmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKCdIaXQgcHVibGljIGluZGV4Jyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgW1wiJHN0YXRlXCIsIFwiJHJvb3RTY29wZVwiLCBcIkF1dGhTZXJ2aWNlXCIsIGZ1bmN0aW9uKCRzdGF0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2Upe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdFxyXG5cdFx0dGhpcy5hdXRoTWVzc2FnZSA9ICcnO1xyXG5cdFx0dGhpcy51c2VyID0ge1xyXG5cdFx0XHRlbWFpbDogJycsXHJcblx0XHRcdHBhc3N3b3JkOiAnJ1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmxvZ2luID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdEF1dGhTZXJ2aWNlLmxvZ2luKHJvb3QudXNlcikudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4nKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHR2bS5hdXRoTWVzc2FnZSA9IHJlcy5kYXRhLnVzZXJNZXNzYWdlO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHR9XSk7XHJcblx0XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdKb2luQ29udHJvbGxlcicsIFtcIiRzdGF0ZVwiLCBcIiRyb290U2NvcGVcIiwgXCJBdXRoU2VydmljZVwiLCBmdW5jdGlvbigkc3RhdGUsICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlKXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR0aGlzLmF1dGhNZXNzYWdlID0gJyc7XHJcblx0XHR0aGlzLnVzZXIgPSB7XHJcblx0XHRcdGZpcnN0TmFtZTogJycsXHJcblx0XHRcdGxhc3ROYW1lOiAnJyxcclxuXHRcdFx0cmV0eXBlUGFzc3dvcmQ6ICcnLCBcclxuXHRcdFx0cGFzc3dvcmQ6ICcnLFxyXG5cdFx0XHRlbWFpbDogJycsXHJcblx0XHRcdGFjY291bnRUeXBlOiAnJ1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLnNpZ251cCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRBdXRoU2VydmljZS5zaWdudXAocm9vdC51c2VyKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbicpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRcdHZtLmF1dGhNZXNzYWdlID0gcmVzLmRhdGEudXNlck1lc3NhZ2U7XHJcblx0XHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cdH1dKTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFtcIiRzdGF0ZVwiLCBcIlVzZXJGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzdGF0ZSwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0dGhpcy51c2VyID0gVXNlckZhY3RvcnkuZ2V0VXNlcigpO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5sb2dpbicsIHtcclxuXHRcdFx0dXJsOiAnL2xvZ2luJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci91c2VyL3BhcnRpYWxzL2xvZ2luLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnbG9naW5DdHJsJ1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3Quam9pbicsIHtcclxuXHRcdFx0dXJsOiAnL2pvaW4nLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvam9pbi5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0pvaW5Db250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnam9pbkN0cmwnXHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3QucHJvZmlsZScsIHtcclxuXHRcdFx0dXJsOiAnL3Byb2ZpbGUnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvcHJvZmlsZS5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAncHJvZmlsZUN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgW1wiJGh0dHBcIiwgXCJVc2VyRmFjdG9yeVwiLCBmdW5jdGlvbiAoJGh0dHAsIFVzZXJGYWN0b3J5KSB7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0bG9naW46IGxvZ2luLFxyXG5cdFx0XHRzaWdudXA6IHNpZ251cCxcclxuXHRcdFx0aXNBdXRoZW50aWNhdGVkOiBpc0F1dGhlbnRpY2F0ZWRcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gbG9naW4oY3JlZGVudGlhbHMpIHtcclxuXHRcdFx0cmV0dXJuICRodHRwXHJcblx0XHRcdC5wb3N0KCcvYXV0aC9sb2NhbCcsIGNyZWRlbnRpYWxzKVxyXG5cdFx0XHQudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcblx0XHRcdFx0VXNlckZhY3Rvcnkuc2V0VXNlcihyZXMuZGF0YSk7XHJcblx0XHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xyXG5cdFx0XHR9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gc2lnbnVwKG5ld1VzZXIpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHBcclxuXHRcdFx0LnBvc3QoJy9hcGkvdXNlci9qb2luJywgbmV3VXNlcilcclxuXHRcdFx0LnRoZW4oXHJcblx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0VXNlckZhY3Rvcnkuc2V0VXNlcihyZXMuZGF0YSk7XHJcblx0XHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xyXG5cdFx0XHR9LCBmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdHJldHVybiByZXMuZGF0YTtcclxuXHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZCgpe1xyXG5cdFx0XHRyZXR1cm4gVXNlckZhY3RvcnkubGl2ZSgpO1xyXG5cdFx0fTtcclxuXHR9XSk7XHJcblxyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuZmFjdG9yeSgnVXNlckZhY3RvcnknLCBbXCIkcm9vdFNjb3BlXCIsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRsaXZlOiBsaXZlLFxyXG5cdFx0XHRzZXRVc2VyOiBzZXRVc2VyLFxyXG5cdFx0XHRnZXRVc2VyOiBnZXRVc2VyLFxyXG5cdFx0XHRkZXN0cm95VXNlcjogZGVzdHJveVVzZXJcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBsaXZlKCl7XHJcblx0XHRcdHJldHVybiAoT2JqZWN0LmtleXMoJHJvb3RTY29wZS5jdXJyZW50VXNlcikubGVuZ3RoID4gMCk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gc2V0VXNlcih1c2VyKXtcclxuXHRcdFx0JHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldFVzZXIoKXtcclxuXHRcdFx0cmV0dXJuICRyb290U2NvcGUuY3VycmVudFVzZXI7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gZGVzdHJveVVzZXIoKXtcclxuXHRcdFx0JHJvb3RTY29wZS5jdXJyZW50VXNlciA9IG51bGw7XHJcblx0XHR9O1xyXG5cdH1dKTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5mYWN0b3J5KCdBdXRoUmVzb2x2ZXInLCBbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24oJHEsICRyb290U2NvcGUsICRzdGF0ZSkge1xyXG5cdFx0dmFyIGJJc1Jlc29sdmVkID0gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzb2x2ZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblx0XHRcdFx0dmFyIHVud2F0Y2ggPSAkcm9vdFNjb3BlLiR3YXRjaCgnY3VycmVudFVzZXInLCBmdW5jdGlvbiAoY3VycmVudFVzZXIpIHtcclxuXHRcdFx0XHRcdGlmIChhbmd1bGFyLmlzRGVmaW5lZChjdXJyZW50VXNlcikpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGN1cnJlbnRVc2VyKSB7XHJcblx0XHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShjdXJyZW50VXNlcik7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0YklzUmVzb2x2ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR1bndhdGNoKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRiSXNSZXNvbHZlZDogZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRyZXR1cm4gYklzUmVzb2x2ZWQ7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0fV0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5tYWluLmRhc2hib2FyZCcsIHtcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9jb3Vyc2VzL3BhcnRpYWxzL2Rhc2hib2FyZC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0Rhc2hib2FyZENvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdkYXNoYm9hcmRDdHJsJ1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3QuY291cnNlJywge1xyXG5cdFx0XHR1cmw6ICcvY291cnNlLzpjb3Vyc2VDb2RlJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9jb3Vyc2VzL3BhcnRpYWxzL2NvdXJzZS5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0NvdXJzZUNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdjb3Vyc2VDdHJsJ1xyXG5cdFx0fSk7XHJcblx0fV0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdjb3Vyc2VzJykuZmFjdG9yeSgnQ291cnNlRmFjdG9yeScsIGZ1bmN0aW9uICgkaHR0cCkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0Y3JlYXRlQ291cnNlOiBjcmVhdGVDb3Vyc2UsXHJcblx0XHRcdGdldENvdXJzZTogZ2V0Q291cnNlLFxyXG5cdFx0XHRnZXRDb3Vyc2VzOiBnZXRDb3Vyc2VzXHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gY3JlYXRlQ291cnNlKG5ld0NvdXJzZSkge1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvY3JlYXRlJywgbmV3Q291cnNlKTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0Q291cnNlKGNvdXJzZUNvZGUpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0Q291cnNlcygpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Byb2ZpbGUvY291cnNlcycpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdnZW5lcmFsJykuY29udHJvbGxlcignTmF2Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRodHRwLCBBdXRoU2VydmljZSwgQXV0aFJlc29sdmVyLCAkc3RhdGUpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHRoaXMuJHN0YXRlID0gJHN0YXRlO1xyXG5cdFx0dGhpcy5iTG9nZ2VkSW4gPSBudWxsO1xyXG5cdFx0XHJcblx0XHRpZiAoQXV0aFJlc29sdmVyLmJJc1Jlc29sdmVkKCkpe1xyXG5cdFx0XHR2bS5iTG9nZ2VkSW4gPSBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKTtcclxuXHRcdH1lbHNle1xyXG5cdFx0XHRBdXRoUmVzb2x2ZXIucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKXtcclxuXHRcdFx0XHR2bS5iTG9nZ2VkSW4gPSBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2dlbmVyYWwnKS5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIpe1xyXG5cclxuXHRcdCRzdGF0ZVByb3ZpZGVyXHJcblx0XHQuc3RhdGUoJ3Jvb3QnLCB7XHJcblx0XHRcdGFic3RyYWN0OiB0cnVlLFxyXG5cdFx0XHR0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nLFxyXG5cdFx0XHRyZXNvbHZlOiB7XHJcblx0XHRcdFx0YXV0aDogZnVuY3Rpb24gcmVzb2x2ZUF1dGhlbnRpY2F0aW9uKEF1dGhSZXNvbHZlcikgeyBcclxuXHRcdFx0XHRcdHJldHVybiAoQXV0aFJlc29sdmVyLmJJc1Jlc29sdmVkKCkgPT09IHRydWUgfHwgQXV0aFJlc29sdmVyLnJlc29sdmUoKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cclxuXHRcdC5zdGF0ZSgncm9vdC5tYWluJywge1xyXG5cdFx0XHR1cmw6ICcvJyxcclxuXHRcdFx0dGVtcGxhdGU6ICc8dWktdmlldy8+JyxcclxuXHRcdFx0Y29udHJvbGxlcjogZnVuY3Rpb24oJHN0YXRlLCBBdXRoU2VydmljZSl7XHJcblx0XHRcdFx0aWYgKEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKXtcclxuXHRcdFx0XHRcdCRzdGF0ZS5nbygncm9vdC5tYWluLmRhc2hib2FyZCcpO1xyXG5cdFx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4ucHVibGljJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cclxuXHRcdC5zdGF0ZSgncm9vdC5tYWluLnB1YmxpYycsIHtcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9nZW5lcmFsL3BhcnRpYWxzL2luZGV4Lmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKCdIaXQgcHVibGljIGluZGV4Jyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHN0YXRlLCAkcm9vdFNjb3BlLCBBdXRoU2VydmljZSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0XHJcblx0XHR0aGlzLmF1dGhNZXNzYWdlID0gJyc7XHJcblx0XHR0aGlzLnVzZXIgPSB7XHJcblx0XHRcdGVtYWlsOiAnJyxcclxuXHRcdFx0cGFzc3dvcmQ6ICcnXHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMubG9naW4gPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0QXV0aFNlcnZpY2UubG9naW4ocm9vdC51c2VyKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbicpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRcdHZtLmF1dGhNZXNzYWdlID0gcmVzLmRhdGEudXNlck1lc3NhZ2U7XHJcblx0XHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cdH0pO1xyXG5cdFxyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignSm9pbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc3RhdGUsICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlKXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR0aGlzLmF1dGhNZXNzYWdlID0gJyc7XHJcblx0XHR0aGlzLnVzZXIgPSB7XHJcblx0XHRcdGZpcnN0TmFtZTogJycsXHJcblx0XHRcdGxhc3ROYW1lOiAnJyxcclxuXHRcdFx0cmV0eXBlUGFzc3dvcmQ6ICcnLCBcclxuXHRcdFx0cGFzc3dvcmQ6ICcnLFxyXG5cdFx0XHRlbWFpbDogJycsXHJcblx0XHRcdGFjY291bnRUeXBlOiAnJ1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLnNpZ251cCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRBdXRoU2VydmljZS5zaWdudXAocm9vdC51c2VyKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbicpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRcdHZtLmF1dGhNZXNzYWdlID0gcmVzLmRhdGEudXNlck1lc3NhZ2U7XHJcblx0XHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cdH0pO1xyXG5cclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHN0YXRlLCBVc2VyRmFjdG9yeSl7XHJcblx0XHR0aGlzLnVzZXIgPSBVc2VyRmFjdG9yeS5nZXRVc2VyKCk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHRcdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdyb290LmxvZ2luJywge1xyXG5cdFx0XHR1cmw6ICcvbG9naW4nLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvbG9naW4uaHRtbCcsXHJcblx0XHRcdGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdsb2dpbkN0cmwnXHJcblx0XHR9KTtcclxuXHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5qb2luJywge1xyXG5cdFx0XHR1cmw6ICcvam9pbicsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvdXNlci9wYXJ0aWFscy9qb2luLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnSm9pbkNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdqb2luQ3RybCdcclxuXHRcdH0pO1xyXG5cdFx0XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5wcm9maWxlJywge1xyXG5cdFx0XHR1cmw6ICcvcHJvZmlsZScsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvdXNlci9wYXJ0aWFscy9wcm9maWxlLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdwcm9maWxlQ3RybCdcclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCBVc2VyRmFjdG9yeSkge1xyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGxvZ2luOiBsb2dpbixcclxuXHRcdFx0c2lnbnVwOiBzaWdudXAsXHJcblx0XHRcdGlzQXV0aGVudGljYXRlZDogaXNBdXRoZW50aWNhdGVkXHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGxvZ2luKGNyZWRlbnRpYWxzKSB7XHJcblx0XHRcdHJldHVybiAkaHR0cFxyXG5cdFx0XHQucG9zdCgnL2F1dGgvbG9jYWwnLCBjcmVkZW50aWFscylcclxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG5cdFx0XHRcdFVzZXJGYWN0b3J5LnNldFVzZXIocmVzLmRhdGEpO1xyXG5cdFx0XHRcdHJldHVybiByZXMuZGF0YTtcclxuXHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIHNpZ251cChuZXdVc2VyKXtcclxuXHRcdFx0cmV0dXJuICRodHRwXHJcblx0XHRcdC5wb3N0KCcvYXBpL3VzZXIvam9pbicsIG5ld1VzZXIpXHJcblx0XHRcdC50aGVuKFxyXG5cdFx0XHRmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdFVzZXJGYWN0b3J5LnNldFVzZXIocmVzLmRhdGEpO1xyXG5cdFx0XHRcdHJldHVybiByZXMuZGF0YTtcclxuXHRcdFx0fSwgZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XHJcblx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKXtcclxuXHRcdFx0cmV0dXJuIFVzZXJGYWN0b3J5LmxpdmUoKTtcclxuXHRcdH07XHJcblx0fSk7XHJcblxyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuZmFjdG9yeSgnVXNlckZhY3RvcnknLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0bGl2ZTogbGl2ZSxcclxuXHRcdFx0c2V0VXNlcjogc2V0VXNlcixcclxuXHRcdFx0Z2V0VXNlcjogZ2V0VXNlcixcclxuXHRcdFx0ZGVzdHJveVVzZXI6IGRlc3Ryb3lVc2VyXHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gbGl2ZSgpe1xyXG5cdFx0XHRyZXR1cm4gKE9iamVjdC5rZXlzKCRyb290U2NvcGUuY3VycmVudFVzZXIpLmxlbmd0aCA+IDApO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIHNldFVzZXIodXNlcil7XHJcblx0XHRcdCRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBnZXRVc2VyKCl7XHJcblx0XHRcdHJldHVybiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGRlc3Ryb3lVc2VyKCl7XHJcblx0XHRcdCRyb290U2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xyXG5cdFx0fTtcclxuXHR9KTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5mYWN0b3J5KCdBdXRoUmVzb2x2ZXInLCBmdW5jdGlvbigkcSwgJHJvb3RTY29wZSwgJHN0YXRlKSB7XHJcblx0XHR2YXIgYklzUmVzb2x2ZWQgPSBmYWxzZTtcclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRyZXNvbHZlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdFx0XHR2YXIgdW53YXRjaCA9ICRyb290U2NvcGUuJHdhdGNoKCdjdXJyZW50VXNlcicsIGZ1bmN0aW9uIChjdXJyZW50VXNlcikge1xyXG5cdFx0XHRcdFx0aWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGN1cnJlbnRVc2VyKSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoY3VycmVudFVzZXIpIHtcclxuXHRcdFx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGN1cnJlbnRVc2VyKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRiSXNSZXNvbHZlZCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdHVud2F0Y2goKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGJJc1Jlc29sdmVkOiBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdHJldHVybiBiSXNSZXNvbHZlZDtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9KTtcclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
