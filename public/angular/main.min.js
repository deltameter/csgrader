!function(){angular.module("assignments",[])}(),function(){angular.module("courses",[])}(),function(){angular.module("general",[])}(),function(){angular.module("misc",[])}(),function(){angular.module("user",[]).run(["$http","UserFactory",function($http,UserFactory){$http.get("/api/profile").success(function(res){UserFactory.setUser(res)}).error(function(res){UserFactory.setUser({})})}])}(),function(){var app=angular.module("grader",["ui.router","general","courses","user","assignments","misc"]);app.config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0)}]),app.run(["$rootScope","AuthService","AuthResolver",function($rootScope,AuthService,AuthResolver){$rootScope.$on("$stateChangeStart",function(event,next){AuthResolver.bIsResolved()?(console.log("stateChangeStart resolved"),console.log("auth: "+AuthService.isAuthenticated())):AuthResolver.resolve().then(function(data){console.log("stateChangeStart not resolved"),console.log("auth: "+AuthService.isAuthenticated())})})}])}(),function(){angular.module("assignments").controller("AssignmentController",["$scope","$stateParams","UserFactory","AssignmentFactory",function($scope,$stateParams,UserFactory,AssignmentFactory){var vm=this;vm.user=UserFactory.getUser(),vm.courseCode=$stateParams.courseCode,vm.assignmentID=$stateParams.assignmentID,vm.assignment={};var getAssignment=function(){AssignmentFactory.getAssignment(vm.courseCode,vm.assignmentID).then(function(assignment){vm.assignment=assignment},function(err){})};this.addQuestion=function(){AssignmentFactory.addQuestion(vm.courseCode,vm.assignmentID).then(function(newQuestion){newQuestion.questionIndex=vm.assignment.questions.length,vm.assignment.content.push(newQuestion),vm.assignment.questions.push(newQuestion)},function(res){})},this.deleteQuestion=function(questionIndex){AssignmentFactory.deleteQuestion(vm.courseCode,vm.assignmentID,questionIndex).then(function(newQuestion){vm.assignment.content.splice(questionIndex,1),$scope.$broadcast("QUESTION_DELETE",questionIndex)},function(res){})},getAssignment()}]).controller("QuestionController",["UserFactory",function(UserFactory){var vm=this;vm.question={},this.logQuestion=function(){console.log(vm.question)}}]).controller("QuestionEditController",["$scope","$stateParams","UserFactory","QuestionFactory",function($scope,$stateParams,UserFactory,QuestionFactory){var vm=this;vm.courseCode=$stateParams.courseCode,vm.assignmentID=$stateParams.assignmentID,vm.question=$scope.$parent.content,$scope.$on("QUESTION_DELETE",function(event,questionIndex){vm.question.questionIndex>questionIndex&&vm.question.questionIndex--}),this.editQuestion=function(){QuestionFactory.editQuestion(vm.courseCode,vm.assignmentID,vm.question).then(function(res){console.log(res)},function(res){console.log(res)})},this.addMCAnswer=function(){console.log(vm.question),vm.question.answerOptions.push("")}}])}(),function(){angular.module("assignments").directive("question",function(){return{restrict:"E",templateUrl:"/angular/assignments/partials/question.html",controller:"QuestionController",controllerAs:"questionCtrl"}}).directive("questionEdit",function(){return{restrict:"E",templateUrl:"/angular/assignments/partials/questionEdit.html",controller:"QuestionEditController",controllerAs:"questionEditCtrl"}})}(),function(){angular.module("assignments").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.assignment",{url:"/course/:courseCode/assignment/:assignmentID",templateUrl:"/angular/assignments/partials/assignment.html",controller:"AssignmentController",controllerAs:"assignmentCtrl"})}])}(),function(){angular.module("assignments").factory("AssignmentFactory",["$http",function($http){function createAssignment(courseCode,newAssignment){return $http.post("/api/course/"+courseCode+"/assignment/create",newAssignment)}function getAssignment(courseCode,assignmentID){return $http.get("/api/course/"+courseCode+"/assignment/"+assignmentID).then(function(res){var assignment=res.data,eI=0,qI=0;assignment.content=new Array(assignment.questions.length+assignment.exercises.length),console.log(assignment);for(var i=0;i<assignment.contentOrder.length;i++)"exercise"===assignment.contentOrder[i]?(assignment.content[i]=assignment.exercises[eI],assignment.content[i].type="exercise",assignment.content[i].exerciseIndex=eI,eI++):"question"===assignment.contentOrder[i]&&(assignment.content[i]=assignment.questions[qI],assignment.content[i].type="question",assignment.content[i].questionIndex=qI,qI++);return assignment},function(res){})}function addQuestion(courseCode,assignmentID){return $http.post("/api/course/"+courseCode+"/assignment/"+assignmentID+"/question/create").then(function(res){var newQuestion=res.data;return newQuestion.type="question",newQuestion})}function deleteQuestion(courseCode,assignmentID,questionIndex){var question={questionIndex:questionIndex};return $http.post("/api/course/"+courseCode+"/assignment/"+assignmentID+"/question/delete",question)}return{createAssignment:createAssignment,getAssignment:getAssignment,addQuestion:addQuestion,deleteQuestion:deleteQuestion}}]).factory("QuestionFactory",["$http",function($http){function editQuestion(courseCode,assignmentID,question){return $http.put("/api/course/"+courseCode+"/assignment/"+assignmentID+"/question/edit",question)}return{editQuestion:editQuestion}}])}(),function(){angular.module("user").controller("DashboardController",["$state","$http","CourseFactory","UserFactory",function($state,$http,CourseFactory,UserFactory){var vm=this;this.newCourse={},this.courses=null,this.user=UserFactory.getUser();var getCourses=function(){CourseFactory.getCourses().then(function(res){vm.courses=res.data},function(res){})};this.createCourse=function(){CourseFactory.createCourse(vm.newCourse).then(function(res){console.log(res)})},getCourses()}]),angular.module("user").controller("CourseController",["$state","$http","$stateParams","UserFactory","CourseFactory","AssignmentFactory",function($state,$http,$stateParams,UserFactory,CourseFactory,AssignmentFactory){var vm=this;this.course=null,this.user=UserFactory.getUser(),this.newAssignment={};var getCourse=function(){CourseFactory.getCourse($stateParams.courseCode).then(function(res){console.log(res),vm.course=res.data,vm.newAssignment.courseID=res.data._id},function(res){})};this.createAssignment=function(){AssignmentFactory.createAssignment($stateParams.courseCode,vm.newAssignment).then(function(res){console.log(res)},function(res){})},getCourse()}])}(),function(){angular.module("user").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.main.dashboard",{templateUrl:"/angular/courses/partials/dashboard.html",controller:"DashboardController",controllerAs:"dashboardCtrl"}),$stateProvider.state("root.course",{url:"/course/:courseCode",templateUrl:"/angular/courses/partials/course.html",controller:"CourseController",controllerAs:"courseCtrl"})}])}(),function(){angular.module("courses").factory("CourseFactory",["$http",function($http){function createCourse(newCourse){return $http.post("/api/course/create",newCourse)}function getCourse(courseCode){return $http.get("/api/course/"+courseCode)}function getCourses(){return $http.get("/api/profile/courses")}return{createCourse:createCourse,getCourse:getCourse,getCourses:getCourses}}])}(),function(){angular.module("general").controller("NavController",["$http","AuthService","AuthResolver","$state",function($http,AuthService,AuthResolver,$state){var vm=this;this.$state=$state,this.bLoggedIn=null,AuthResolver.bIsResolved()?vm.bLoggedIn=AuthService.isAuthenticated():AuthResolver.resolve().then(function(){vm.bLoggedIn=AuthService.isAuthenticated()})}])}(),function(){angular.module("general").config(["$stateProvider",function($stateProvider){$stateProvider.state("root",{"abstract":!0,template:"<ui-view/>",resolve:{auth:["AuthResolver",function(AuthResolver){return AuthResolver.bIsResolved()===!0||AuthResolver.resolve()}]}}).state("root.main",{url:"/",template:"<ui-view/>",controller:["$state","AuthService",function($state,AuthService){AuthService.isAuthenticated()?$state.go("root.main.dashboard"):$state.go("root.main.public")}]}).state("root.main.public",{templateUrl:"/angular/general/partials/index.html",controller:function(){console.log("Hit public index")}})}])}(),function(){"use strict";function clickOutside($document,$parse,$timeout){return{restrict:"A",link:function($scope,elem,attr){console.log("hi"),$timeout(function(){function eventHandler(e){if(!angular.element(elem).hasClass("ng-hide")){var element,i=0;if(e&&e.target){for(element=e.target;element;element=element.parentNode){var id=element.id,classNames=element.className,l=classList.length;for(classNames&&void 0!==classNames.baseVal&&(classNames=classNames.baseVal),i=0;l>i;i++)if(void 0!==id&&id===classList[i]||classNames&&classNames===classList[i])return}return $scope.$apply(function(){return(fn=$parse(attr.clickOutside))($scope)})}}}function _hasTouch(){return"ontouchstart"in window||navigator.maxTouchPoints}var fn,classList=void 0!==attr.outsideIfNot?attr.outsideIfNot.replace(", ",",").split(","):[];void 0!==attr.id&&classList.push(attr.id),_hasTouch()&&$document.on("touchstart",eventHandler),$document.on("click",eventHandler),$scope.$on("$destroy",function(){_hasTouch()&&$document.off("touchstart",eventHandler),$document.off("click",eventHandler)})})}}}clickOutside.$inject=["$document","$parse","$timeout"],angular.module("misc").directive("clickOutside",clickOutside)}(),function(){angular.module("user").controller("LoginController",["$state","$rootScope","AuthService",function($state,$rootScope,AuthService){var vm=this;this.authMessage="",this.user={email:"",password:""},this.login=function(){AuthService.login(root.user).then(function(res){$state.go("root.main")},function(res){vm.authMessage=res.data.userMessage})}}]),angular.module("user").controller("JoinController",["$state","$rootScope","AuthService",function($state,$rootScope,AuthService){var vm=this;this.authMessage="",this.user={firstName:"",lastName:"",retypePassword:"",password:"",email:"",accountType:""},this.signup=function(){AuthService.signup(root.user).then(function(res){$state.go("root.main")},function(res){vm.authMessage=res.data.userMessage})}}]),angular.module("user").controller("ProfileController",["$state","UserFactory",function($state,UserFactory){this.user=UserFactory.getUser()}])}(),function(){angular.module("user").config(["$stateProvider",function($stateProvider){$stateProvider.state("root.login",{url:"/login",templateUrl:"/angular/user/partials/login.html",controller:"LoginController",controllerAs:"loginCtrl"}),$stateProvider.state("root.join",{url:"/join",templateUrl:"/angular/user/partials/join.html",controller:"JoinController",controllerAs:"joinCtrl"}),$stateProvider.state("root.profile",{url:"/profile",templateUrl:"/angular/user/partials/profile.html",controller:"ProfileController",controllerAs:"profileCtrl"})}])}(),function(){angular.module("user").factory("AuthService",["$http","UserFactory",function($http,UserFactory){function login(credentials){return $http.post("/auth/local",credentials).then(function(res){return UserFactory.setUser(res.data),res.data})}function signup(newUser){return $http.post("/api/user/join",newUser).then(function(res){return UserFactory.setUser(res.data),res.data},function(res){return res.data})}function isAuthenticated(){return UserFactory.live()}return{login:login,signup:signup,isAuthenticated:isAuthenticated}}]),angular.module("user").factory("UserFactory",["$rootScope",function($rootScope){function live(){return Object.keys($rootScope.currentUser).length>0}function setUser(user){$rootScope.currentUser=user}function getUser(){return $rootScope.currentUser}function destroyUser(){$rootScope.currentUser=null}return{live:live,setUser:setUser,getUser:getUser,destroyUser:destroyUser}}]),angular.module("user").factory("AuthResolver",["$q","$rootScope","$state",function($q,$rootScope,$state){var bIsResolved=!1;return{resolve:function(){var deferred=$q.defer(),unwatch=$rootScope.$watch("currentUser",function(currentUser){angular.isDefined(currentUser)&&(currentUser?deferred.resolve(currentUser):deferred.reject(),bIsResolved=!0,unwatch())});return deferred.promise},bIsResolved:function(){return bIsResolved}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2lnbm1lbnRzL2Fzc2lnbm1lbnRzLm1vZHVsZS5qcyIsImNvdXJzZXMvY291cnNlcy5tb2R1bGUuanMiLCJnZW5lcmFsL2dlbmVyYWwubW9kdWxlLmpzIiwibWlzYy9taXNjLm1vZHVsZS5qcyIsInVzZXIvdXNlci5tb2R1bGUuanMiLCJjb3JlLmpzIiwiYXNzaWdubWVudHMvYXNzaWdubWVudHMuY3RybC5qcyIsImFzc2lnbm1lbnRzL2Fzc2lnbm1lbnRzLmRpci5qcyIsImFzc2lnbm1lbnRzL2Fzc2lnbm1lbnRzLnN0YXRlcy5qcyIsImFzc2lnbm1lbnRzL2Fzc2lnbm1lbnRzLnN2Yy5qcyIsImNvdXJzZXMvY291cnNlcy5jdHJsLmpzIiwibWFpbi5taW4uanMiLCJjb3Vyc2VzL2NvdXJzZXMuc3RhdGVzLmpzIiwiY291cnNlcy9jb3Vyc2VzLnN2Yy5qcyIsImdlbmVyYWwvZ2VuZXJhbC5jdHJsLmpzIiwiZ2VuZXJhbC9nZW5lcmFsLnN0YXRlcy5qcyIsIm1pc2MvY2xpY2tvdXRzaWRlLmRpci5qcyIsInVzZXIvdXNlci5jdHJsLmpzIiwidXNlci91c2VyLnN0YXRlcy5qcyIsInVzZXIvdXNlci5zdmMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsInJ1biIsIiRodHRwIiwiVXNlckZhY3RvcnkiLCJnZXQiLCJzdWNjZXNzIiwicmVzIiwic2V0VXNlciIsImVycm9yIiwiYXBwIiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJodG1sNU1vZGUiLCIkcm9vdFNjb3BlIiwiQXV0aFNlcnZpY2UiLCJBdXRoUmVzb2x2ZXIiLCIkb24iLCJldmVudCIsIm5leHQiLCJiSXNSZXNvbHZlZCIsImNvbnNvbGUiLCJsb2ciLCJpc0F1dGhlbnRpY2F0ZWQiLCJyZXNvbHZlIiwidGhlbiIsImRhdGEiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlUGFyYW1zIiwiQXNzaWdubWVudEZhY3RvcnkiLCJ2bSIsInRoaXMiLCJ1c2VyIiwiZ2V0VXNlciIsImNvdXJzZUNvZGUiLCJhc3NpZ25tZW50SUQiLCJhc3NpZ25tZW50IiwiZ2V0QXNzaWdubWVudCIsImVyciIsImFkZFF1ZXN0aW9uIiwibmV3UXVlc3Rpb24iLCJxdWVzdGlvbkluZGV4IiwicXVlc3Rpb25zIiwibGVuZ3RoIiwiY29udGVudCIsInB1c2giLCJkZWxldGVRdWVzdGlvbiIsInNwbGljZSIsIiRicm9hZGNhc3QiLCJxdWVzdGlvbiIsImxvZ1F1ZXN0aW9uIiwiUXVlc3Rpb25GYWN0b3J5IiwiJHBhcmVudCIsImVkaXRRdWVzdGlvbiIsImFkZE1DQW5zd2VyIiwiYW5zd2VyT3B0aW9ucyIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyQXMiLCIkc3RhdGVQcm92aWRlciIsInN0YXRlIiwidXJsIiwiZmFjdG9yeSIsImNyZWF0ZUFzc2lnbm1lbnQiLCJuZXdBc3NpZ25tZW50IiwicG9zdCIsImVJIiwicUkiLCJBcnJheSIsImV4ZXJjaXNlcyIsImkiLCJjb250ZW50T3JkZXIiLCJ0eXBlIiwiZXhlcmNpc2VJbmRleCIsInB1dCIsIiRzdGF0ZSIsIkNvdXJzZUZhY3RvcnkiLCJuZXdDb3Vyc2UiLCJjb3Vyc2VzIiwiZ2V0Q291cnNlcyIsImNyZWF0ZUNvdXJzZSIsImNvdXJzZSIsImdldENvdXJzZSIsImNvdXJzZUlEIiwiX2lkIiwiYkxvZ2dlZEluIiwiYWJzdHJhY3QiLCJ0ZW1wbGF0ZSIsImF1dGgiLCJnbyIsImNsaWNrT3V0c2lkZSIsIiRkb2N1bWVudCIsIiRwYXJzZSIsIiR0aW1lb3V0IiwibGluayIsImVsZW0iLCJhdHRyIiwiZXZlbnRIYW5kbGVyIiwiZSIsImVsZW1lbnQiLCJoYXNDbGFzcyIsInRhcmdldCIsInBhcmVudE5vZGUiLCJpZCIsImNsYXNzTmFtZXMiLCJjbGFzc05hbWUiLCJsIiwiY2xhc3NMaXN0IiwidW5kZWZpbmVkIiwiYmFzZVZhbCIsIiRhcHBseSIsImZuIiwiX2hhc1RvdWNoIiwid2luZG93IiwibmF2aWdhdG9yIiwibWF4VG91Y2hQb2ludHMiLCJvdXRzaWRlSWZOb3QiLCJyZXBsYWNlIiwic3BsaXQiLCJvbiIsIm9mZiIsIiRpbmplY3QiLCJhdXRoTWVzc2FnZSIsImVtYWlsIiwicGFzc3dvcmQiLCJsb2dpbiIsInJvb3QiLCJ1c2VyTWVzc2FnZSIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwicmV0eXBlUGFzc3dvcmQiLCJhY2NvdW50VHlwZSIsInNpZ251cCIsImNyZWRlbnRpYWxzIiwibmV3VXNlciIsImxpdmUiLCJPYmplY3QiLCJrZXlzIiwiY3VycmVudFVzZXIiLCJkZXN0cm95VXNlciIsIiRxIiwiZGVmZXJyZWQiLCJkZWZlciIsInVud2F0Y2giLCIkd2F0Y2giLCJpc0RlZmluZWQiLCJyZWplY3QiLCJwcm9taXNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBQSxRQUFBQyxPQUFBLHFCQ0RBLFdBQ0FELFFBQUFDLE9BQUEsaUJDREEsV0FDQUQsUUFBQUMsT0FBQSxpQkNEQSxXQUNBRCxRQUFBQyxPQUFBLGNDREEsV0FDQUQsUUFBQUMsT0FBQSxXQUNBQyxLQUFBLFFBQUEsY0FBQSxTQUFBQyxNQUFBQyxhQUNBRCxNQUFBRSxJQUFBLGdCQUNBQyxRQUFBLFNBQUFDLEtBQ0FILFlBQUFJLFFBQUFELE9BRUFFLE1BQUEsU0FBQUYsS0FDQUgsWUFBQUksb0JDUkEsV0FDQSxHQUFBRSxLQUFBVixRQUFBQyxPQUFBLFVBRUEsWUFDQSxVQUNBLFVBQ0EsT0FDQSxjQUNBLFFBSUFTLEtBQUFDLFFBQUEsb0JBQUEsU0FBQUMsbUJBQ0FBLGtCQUFBQyxXQUFBLE1BR0FILElBQUFSLEtBQUEsYUFBQSxjQUFBLGVBQUEsU0FBQVksV0FBQUMsWUFBQUMsY0FDQUYsV0FBQUcsSUFBQSxvQkFBQSxTQUFBQyxNQUFBQyxNQUNBSCxhQUFBSSxlQUNBQyxRQUFBQyxJQUFBLDZCQUNBRCxRQUFBQyxJQUFBLFNBQUFQLFlBQUFRLG9CQUVBUCxhQUFBUSxVQUFBQyxLQUFBLFNBQUFDLE1BQ0FMLFFBQUFDLElBQUEsaUNBQ0FE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QUEsV0FDQSxNQUFBQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnLCBbXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjb3Vyc2VzJywgW10pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ2VuZXJhbCcsIFtdKTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ21pc2MnLCBbXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCd1c2VyJywgW10pXHJcblx0LnJ1bihmdW5jdGlvbigkaHR0cCwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0JGh0dHAuZ2V0KCcvYXBpL3Byb2ZpbGUnKVxyXG5cdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0VXNlckZhY3Rvcnkuc2V0VXNlcihyZXMpO1xyXG5cdFx0fSlcclxuXHRcdC5lcnJvcihmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHt9KTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ3JhZGVyJywgXHJcblx0XHRbXHJcblx0XHRcdCd1aS5yb3V0ZXInLFxyXG5cdFx0XHQnZ2VuZXJhbCcsXHJcblx0XHRcdCdjb3Vyc2VzJyxcclxuXHRcdFx0J3VzZXInLFxyXG5cdFx0XHQnYXNzaWdubWVudHMnLFxyXG5cdFx0XHQnbWlzYydcclxuXHRcdF0pO1xyXG5cclxuXHQvL3JlbW92ZSB0aGUgaGFzaFxyXG5cdGFwcC5jb25maWcoWyckbG9jYXRpb25Qcm92aWRlcicsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyKXtcclxuXHRcdCRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHR9XSk7XHJcblx0XHJcblx0YXBwLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgQXV0aFNlcnZpY2UsIEF1dGhSZXNvbHZlcikge1xyXG4gIFx0XHQkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIG5leHQpIHtcclxuICBcdFx0XHRpZiAoQXV0aFJlc29sdmVyLmJJc1Jlc29sdmVkKCkpe1xyXG4gIFx0XHRcdFx0Y29uc29sZS5sb2coJ3N0YXRlQ2hhbmdlU3RhcnQgcmVzb2x2ZWQnKTtcclxuICBcdFx0XHRcdGNvbnNvbGUubG9nKCdhdXRoOiAnICsgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpO1xyXG4gIFx0XHRcdH1lbHNle1xyXG4gIFx0XHRcdFx0QXV0aFJlc29sdmVyLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xyXG4gIFx0XHRcdFx0XHRjb25zb2xlLmxvZygnc3RhdGVDaGFuZ2VTdGFydCBub3QgcmVzb2x2ZWQnKTtcclxuICBcdFx0XHRcdFx0Y29uc29sZS5sb2coJ2F1dGg6ICcgKyBBdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSk7XHJcbiAgXHRcdFx0XHR9KVxyXG4gIFx0XHRcdH1cclxuICBcdFx0fSk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJylcclxuXHJcblx0LmNvbnRyb2xsZXIoJ0Fzc2lnbm1lbnRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIFVzZXJGYWN0b3J5LCBBc3NpZ25tZW50RmFjdG9yeSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dm0udXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHRcdHZtLmNvdXJzZUNvZGUgPSAkc3RhdGVQYXJhbXMuY291cnNlQ29kZTtcclxuXHRcdHZtLmFzc2lnbm1lbnRJRCA9ICRzdGF0ZVBhcmFtcy5hc3NpZ25tZW50SUQ7XHJcblxyXG5cdFx0dm0uYXNzaWdubWVudCA9IHt9O1xyXG5cclxuXHRcdHZhciBnZXRBc3NpZ25tZW50ID0gZnVuY3Rpb24oKXtcclxuIFx0XHRcdEFzc2lnbm1lbnRGYWN0b3J5LmdldEFzc2lnbm1lbnQodm0uY291cnNlQ29kZSwgdm0uYXNzaWdubWVudElEKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MoYXNzaWdubWVudCl7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50ID0gYXNzaWdubWVudDtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUoZXJyKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdEFzc2lnbm1lbnRGYWN0b3J5LmFkZFF1ZXN0aW9uKHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKG5ld1F1ZXN0aW9uKXtcclxuXHRcdFx0XHRcdG5ld1F1ZXN0aW9uLnF1ZXN0aW9uSW5kZXggPSB2bS5hc3NpZ25tZW50LnF1ZXN0aW9ucy5sZW5ndGg7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50LmNvbnRlbnQucHVzaChuZXdRdWVzdGlvbik7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50LnF1ZXN0aW9ucy5wdXNoKG5ld1F1ZXN0aW9uKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRoaXMuZGVsZXRlUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbkluZGV4KXtcclxuXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuZGVsZXRlUXVlc3Rpb24odm0uY291cnNlQ29kZSwgdm0uYXNzaWdubWVudElELCBxdWVzdGlvbkluZGV4KS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MobmV3UXVlc3Rpb24pe1xyXG5cdFx0XHRcdFx0dm0uYXNzaWdubWVudC5jb250ZW50LnNwbGljZShxdWVzdGlvbkluZGV4LCAxKTtcclxuXHRcdFx0XHRcdCRzY29wZS4kYnJvYWRjYXN0KCdRVUVTVElPTl9ERUxFVEUnLCBxdWVzdGlvbkluZGV4KTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0QXNzaWdubWVudCgpO1xyXG5cdH0pXHJcblxyXG5cdC5jb250cm9sbGVyKCdRdWVzdGlvbkNvbnRyb2xsZXInLCBmdW5jdGlvbihVc2VyRmFjdG9yeSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cclxuXHRcdC8vcXVlc3Rpb24gaXMgaW5zdGFudGlhdGVkIHRocm91Z2ggdGhlIG5nLWluaXRcclxuXHRcdHZtLnF1ZXN0aW9uID0ge307XHJcblx0XHRcclxuXHRcdHRoaXMubG9nUXVlc3Rpb24gPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRjb25zb2xlLmxvZyh2bS5xdWVzdGlvbik7XHJcblx0XHR9XHJcblx0fSlcclxuXHJcblx0LmNvbnRyb2xsZXIoJ1F1ZXN0aW9uRWRpdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZVBhcmFtcywgVXNlckZhY3RvcnksIFF1ZXN0aW9uRmFjdG9yeSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dm0uY291cnNlQ29kZSA9ICRzdGF0ZVBhcmFtcy5jb3Vyc2VDb2RlO1xyXG5cdFx0dm0uYXNzaWdubWVudElEID0gJHN0YXRlUGFyYW1zLmFzc2lnbm1lbnRJRDtcclxuXHRcdFxyXG5cdFx0Ly9nZXQgdGhlIHF1ZXN0aW9uIGNvbnRlbnRzIGZyb20gdGhlIHBhcmVudCBzY29wZVxyXG5cdFx0dm0ucXVlc3Rpb24gPSAkc2NvcGUuJHBhcmVudC5jb250ZW50O1xyXG5cclxuXHRcdCRzY29wZS4kb24oJ1FVRVNUSU9OX0RFTEVURScsIGZ1bmN0aW9uKGV2ZW50LCBxdWVzdGlvbkluZGV4KXtcclxuXHRcdFx0aWYgKHZtLnF1ZXN0aW9uLnF1ZXN0aW9uSW5kZXggPiBxdWVzdGlvbkluZGV4KXtcclxuXHRcdFx0XHR2bS5xdWVzdGlvbi5xdWVzdGlvbkluZGV4LS07XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuZWRpdFF1ZXN0aW9uID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0UXVlc3Rpb25GYWN0b3J5LmVkaXRRdWVzdGlvbih2bS5jb3Vyc2VDb2RlLCB2bS5hc3NpZ25tZW50SUQsIHZtLnF1ZXN0aW9uKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbiBGYWlsdXJlKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0KVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuYWRkTUNBbnN3ZXIgPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRjb25zb2xlLmxvZyh2bS5xdWVzdGlvbik7XHJcblx0XHRcdHZtLnF1ZXN0aW9uLmFuc3dlck9wdGlvbnMucHVzaCgnJyk7XHJcblx0XHR9XHJcblx0fSlcclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJylcclxuXHQuZGlyZWN0aXZlKCdxdWVzdGlvbicsIGZ1bmN0aW9uKCl7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRyZXN0cmljdDogJ0UnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2Fzc2lnbm1lbnRzL3BhcnRpYWxzL3F1ZXN0aW9uLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnUXVlc3Rpb25Db250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAncXVlc3Rpb25DdHJsJ1xyXG5cdFx0fVxyXG5cdH0pXHJcblx0LmRpcmVjdGl2ZSgncXVlc3Rpb25FZGl0JywgZnVuY3Rpb24oKXtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHJlc3RyaWN0OiAnRScsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvYXNzaWdubWVudHMvcGFydGlhbHMvcXVlc3Rpb25FZGl0Lmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnUXVlc3Rpb25FZGl0Q29udHJvbGxlcicsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ3F1ZXN0aW9uRWRpdEN0cmwnXHJcblx0XHR9XHJcblx0fSlcclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKS5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHRcdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdyb290LmFzc2lnbm1lbnQnLCB7XHJcblx0XHRcdHVybDogJy9jb3Vyc2UvOmNvdXJzZUNvZGUvYXNzaWdubWVudC86YXNzaWdubWVudElEJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9hc3NpZ25tZW50cy9wYXJ0aWFscy9hc3NpZ25tZW50Lmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnQXNzaWdubWVudENvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdhc3NpZ25tZW50Q3RybCdcclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKS5mYWN0b3J5KCdBc3NpZ25tZW50RmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjcmVhdGVBc3NpZ25tZW50OiBjcmVhdGVBc3NpZ25tZW50LFxyXG5cdFx0XHRnZXRBc3NpZ25tZW50OiBnZXRBc3NpZ25tZW50LFxyXG5cdFx0XHRhZGRRdWVzdGlvbjogYWRkUXVlc3Rpb24sXHJcblx0XHRcdGRlbGV0ZVF1ZXN0aW9uOiBkZWxldGVRdWVzdGlvblxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBjcmVhdGVBc3NpZ25tZW50KGNvdXJzZUNvZGUsIG5ld0Fzc2lnbm1lbnQpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvY3JlYXRlJywgbmV3QXNzaWdubWVudCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldEFzc2lnbm1lbnQoY291cnNlQ29kZSwgYXNzaWdubWVudElEKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGFzc2lnbm1lbnQgPSByZXMuZGF0YTtcclxuXHRcdFx0XHRcdHZhciBlSSA9IDAsIHFJID0gMDtcclxuXHJcblx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnQgPSBuZXcgQXJyYXkoYXNzaWdubWVudC5xdWVzdGlvbnMubGVuZ3RoICsgYXNzaWdubWVudC5leGVyY2lzZXMubGVuZ3RoKTtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGFzc2lnbm1lbnQpO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhc3NpZ25tZW50LmNvbnRlbnRPcmRlci5sZW5ndGg7IGkrKyl7XHJcblx0XHRcdFx0XHRcdC8vdHJ1ZSA9IGV4ZXJjaXNlLCBmYWxzZSA9IHF1ZXN0aW9uXHJcblx0XHRcdFx0XHRcdGlmIChhc3NpZ25tZW50LmNvbnRlbnRPcmRlcltpXSA9PT0gJ2V4ZXJjaXNlJyl7XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldID0gYXNzaWdubWVudC5leGVyY2lzZXNbZUldO1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXS50eXBlID0gJ2V4ZXJjaXNlJztcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0uZXhlcmNpc2VJbmRleCA9IGVJXHJcblx0XHRcdFx0XHRcdFx0ZUkrKztcclxuXHRcdFx0XHRcdFx0fWVsc2UgaWYgKGFzc2lnbm1lbnQuY29udGVudE9yZGVyW2ldID09PSAncXVlc3Rpb24nKXtcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0gPSBhc3NpZ25tZW50LnF1ZXN0aW9uc1txSV07XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldLnR5cGUgPSAncXVlc3Rpb24nO1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXS5xdWVzdGlvbkluZGV4ID0gcUlcclxuXHRcdFx0XHRcdFx0XHRxSSsrXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJldHVybiBhc3NpZ25tZW50O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGFkZFF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEICsgJy9xdWVzdGlvbi9jcmVhdGUnKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHRcdFx0XHRcdHZhciBuZXdRdWVzdGlvbiA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdFx0bmV3UXVlc3Rpb24udHlwZSA9ICdxdWVzdGlvbic7XHJcblx0XHRcdFx0XHRyZXR1cm4gbmV3UXVlc3Rpb247XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGRlbGV0ZVF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCwgcXVlc3Rpb25JbmRleCl7XHJcblx0XHRcdHZhciBxdWVzdGlvbiA9IHsgcXVlc3Rpb25JbmRleDogcXVlc3Rpb25JbmRleCB9O1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCArICcvcXVlc3Rpb24vZGVsZXRlJywgcXVlc3Rpb24pO1xyXG5cdFx0fVxyXG5cdH0pXHJcblxyXG5cdC5mYWN0b3J5KCdRdWVzdGlvbkZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCl7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0ZWRpdFF1ZXN0aW9uOiBlZGl0UXVlc3Rpb25cclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gZWRpdFF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCwgcXVlc3Rpb24pe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEICsgJy9xdWVzdGlvbi9lZGl0JywgcXVlc3Rpb24pO1xyXG5cdFx0fVxyXG5cdH0pXHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgZnVuY3Rpb24oJHN0YXRlLCAkaHR0cCwgQ291cnNlRmFjdG9yeSwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHRoaXMubmV3Q291cnNlID0ge307XHJcblx0XHR0aGlzLmNvdXJzZXMgPSBudWxsO1xyXG5cdFx0dGhpcy51c2VyID0gVXNlckZhY3RvcnkuZ2V0VXNlcigpO1xyXG5cclxuXHRcdHZhciBnZXRDb3Vyc2VzID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5nZXRDb3Vyc2VzKCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHR2bS5jb3Vyc2VzID0gcmVzLmRhdGE7XHJcblx0XHRcdFx0fSwgXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuY3JlYXRlQ291cnNlID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5jcmVhdGVDb3Vyc2Uodm0ubmV3Q291cnNlKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0Q291cnNlcygpO1xyXG5cdH0pO1xyXG5cclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ0NvdXJzZUNvbnRyb2xsZXInLCBcclxuXHRcdGZ1bmN0aW9uKCRzdGF0ZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgVXNlckZhY3RvcnksIENvdXJzZUZhY3RvcnksIEFzc2lnbm1lbnRGYWN0b3J5KXtcclxuXHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuY291cnNlID0gbnVsbDtcclxuXHRcdHRoaXMudXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHRcdHRoaXMubmV3QXNzaWdubWVudCA9IHt9O1xyXG5cclxuXHRcdHZhciBnZXRDb3Vyc2UgPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRDb3Vyc2VGYWN0b3J5LmdldENvdXJzZSgkc3RhdGVQYXJhbXMuY291cnNlQ29kZSkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdFx0dm0uY291cnNlID0gcmVzLmRhdGE7XHJcblx0XHRcdFx0XHR2bS5uZXdBc3NpZ25tZW50LmNvdXJzZUlEID0gcmVzLmRhdGEuX2lkO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmNyZWF0ZUFzc2lnbm1lbnQgPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRBc3NpZ25tZW50RmFjdG9yeS5jcmVhdGVBc3NpZ25tZW50KCRzdGF0ZVBhcmFtcy5jb3Vyc2VDb2RlLCB2bS5uZXdBc3NpZ25tZW50KS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdFx0fSwgXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0Q291cnNlKCk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhc3NpZ25tZW50cycsIFtdKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY291cnNlcycsIFtdKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ2VuZXJhbCcsIFtdKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbWlzYycsIFtdKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgndXNlcicsIFtdKVxyXG5cdC5ydW4oW1wiJGh0dHBcIiwgXCJVc2VyRmFjdG9yeVwiLCBmdW5jdGlvbigkaHR0cCwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0JGh0dHAuZ2V0KCcvYXBpL3Byb2ZpbGUnKVxyXG5cdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0VXNlckZhY3Rvcnkuc2V0VXNlcihyZXMpO1xyXG5cdFx0fSlcclxuXHRcdC5lcnJvcihmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHt9KTtcclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZ3JhZGVyJywgXHJcblx0XHRbXHJcblx0XHRcdCd1aS5yb3V0ZXInLFxyXG5cdFx0XHQnZ2VuZXJhbCcsXHJcblx0XHRcdCdjb3Vyc2VzJyxcclxuXHRcdFx0J3VzZXInLFxyXG5cdFx0XHQnYXNzaWdubWVudHMnLFxyXG5cdFx0XHQnbWlzYydcclxuXHRcdF0pO1xyXG5cclxuXHQvL3JlbW92ZSB0aGUgaGFzaFxyXG5cdGFwcC5jb25maWcoWyckbG9jYXRpb25Qcm92aWRlcicsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyKXtcclxuXHRcdCRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHR9XSk7XHJcblx0XHJcblx0YXBwLnJ1bihbXCIkcm9vdFNjb3BlXCIsIFwiQXV0aFNlcnZpY2VcIiwgXCJBdXRoUmVzb2x2ZXJcIiwgZnVuY3Rpb24gKCRyb290U2NvcGUsIEF1dGhTZXJ2aWNlLCBBdXRoUmVzb2x2ZXIpIHtcclxuICBcdFx0JHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCBuZXh0KSB7XHJcbiAgXHRcdFx0aWYgKEF1dGhSZXNvbHZlci5iSXNSZXNvbHZlZCgpKXtcclxuICBcdFx0XHRcdGNvbnNvbGUubG9nKCdzdGF0ZUNoYW5nZVN0YXJ0IHJlc29sdmVkJyk7XHJcbiAgXHRcdFx0XHRjb25zb2xlLmxvZygnYXV0aDogJyArIEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKTtcclxuICBcdFx0XHR9ZWxzZXtcclxuICBcdFx0XHRcdEF1dGhSZXNvbHZlci5yZXNvbHZlKCkudGhlbihmdW5jdGlvbihkYXRhKXtcclxuICBcdFx0XHRcdFx0Y29uc29sZS5sb2coJ3N0YXRlQ2hhbmdlU3RhcnQgbm90IHJlc29sdmVkJyk7XHJcbiAgXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdhdXRoOiAnICsgQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpO1xyXG4gIFx0XHRcdFx0fSlcclxuICBcdFx0XHR9XHJcbiAgXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdhc3NpZ25tZW50cycpXHJcblxyXG5cdC5jb250cm9sbGVyKCdBc3NpZ25tZW50Q29udHJvbGxlcicsIFtcIiRzY29wZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIlVzZXJGYWN0b3J5XCIsIFwiQXNzaWdubWVudEZhY3RvcnlcIiwgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIFVzZXJGYWN0b3J5LCBBc3NpZ25tZW50RmFjdG9yeSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dm0udXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHRcdHZtLmNvdXJzZUNvZGUgPSAkc3RhdGVQYXJhbXMuY291cnNlQ29kZTtcclxuXHRcdHZtLmFzc2lnbm1lbnRJRCA9ICRzdGF0ZVBhcmFtcy5hc3NpZ25tZW50SUQ7XHJcblxyXG5cdFx0dm0uYXNzaWdubWVudCA9IHt9O1xyXG5cclxuXHRcdHZhciBnZXRBc3NpZ25tZW50ID0gZnVuY3Rpb24oKXtcclxuIFx0XHRcdEFzc2lnbm1lbnRGYWN0b3J5LmdldEFzc2lnbm1lbnQodm0uY291cnNlQ29kZSwgdm0uYXNzaWdubWVudElEKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MoYXNzaWdubWVudCl7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50ID0gYXNzaWdubWVudDtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUoZXJyKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdEFzc2lnbm1lbnRGYWN0b3J5LmFkZFF1ZXN0aW9uKHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKG5ld1F1ZXN0aW9uKXtcclxuXHRcdFx0XHRcdG5ld1F1ZXN0aW9uLnF1ZXN0aW9uSW5kZXggPSB2bS5hc3NpZ25tZW50LnF1ZXN0aW9ucy5sZW5ndGg7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50LmNvbnRlbnQucHVzaChuZXdRdWVzdGlvbik7XHJcblx0XHRcdFx0XHR2bS5hc3NpZ25tZW50LnF1ZXN0aW9ucy5wdXNoKG5ld1F1ZXN0aW9uKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRoaXMuZGVsZXRlUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbkluZGV4KXtcclxuXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuZGVsZXRlUXVlc3Rpb24odm0uY291cnNlQ29kZSwgdm0uYXNzaWdubWVudElELCBxdWVzdGlvbkluZGV4KS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MobmV3UXVlc3Rpb24pe1xyXG5cdFx0XHRcdFx0dm0uYXNzaWdubWVudC5jb250ZW50LnNwbGljZShxdWVzdGlvbkluZGV4LCAxKTtcclxuXHRcdFx0XHRcdCRzY29wZS4kYnJvYWRjYXN0KCdRVUVTVElPTl9ERUxFVEUnLCBxdWVzdGlvbkluZGV4KTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0Z2V0QXNzaWdubWVudCgpO1xyXG5cdH1dKVxyXG5cclxuXHQuY29udHJvbGxlcignUXVlc3Rpb25Db250cm9sbGVyJywgW1wiVXNlckZhY3RvcnlcIiwgZnVuY3Rpb24oVXNlckZhY3Rvcnkpe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHJcblx0XHQvL3F1ZXN0aW9uIGlzIGluc3RhbnRpYXRlZCB0aHJvdWdoIHRoZSBuZy1pbml0XHJcblx0XHR2bS5xdWVzdGlvbiA9IHt9O1xyXG5cdFx0XHJcblx0XHR0aGlzLmxvZ1F1ZXN0aW9uID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Y29uc29sZS5sb2codm0ucXVlc3Rpb24pO1xyXG5cdFx0fVxyXG5cdH1dKVxyXG5cclxuXHQuY29udHJvbGxlcignUXVlc3Rpb25FZGl0Q29udHJvbGxlcicsIFtcIiRzY29wZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIlVzZXJGYWN0b3J5XCIsIFwiUXVlc3Rpb25GYWN0b3J5XCIsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlUGFyYW1zLCBVc2VyRmFjdG9yeSwgUXVlc3Rpb25GYWN0b3J5KXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR2bS5jb3Vyc2VDb2RlID0gJHN0YXRlUGFyYW1zLmNvdXJzZUNvZGU7XHJcblx0XHR2bS5hc3NpZ25tZW50SUQgPSAkc3RhdGVQYXJhbXMuYXNzaWdubWVudElEO1xyXG5cdFx0XHJcblx0XHQvL2dldCB0aGUgcXVlc3Rpb24gY29udGVudHMgZnJvbSB0aGUgcGFyZW50IHNjb3BlXHJcblx0XHR2bS5xdWVzdGlvbiA9ICRzY29wZS4kcGFyZW50LmNvbnRlbnQ7XHJcblxyXG5cdFx0JHNjb3BlLiRvbignUVVFU1RJT05fREVMRVRFJywgZnVuY3Rpb24oZXZlbnQsIHF1ZXN0aW9uSW5kZXgpe1xyXG5cdFx0XHRpZiAodm0ucXVlc3Rpb24ucXVlc3Rpb25JbmRleCA+IHF1ZXN0aW9uSW5kZXgpe1xyXG5cdFx0XHRcdHZtLnF1ZXN0aW9uLnF1ZXN0aW9uSW5kZXgtLTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5lZGl0UXVlc3Rpb24gPSBmdW5jdGlvbigpe1xyXG5cdFx0XHRRdWVzdGlvbkZhY3RvcnkuZWRpdFF1ZXN0aW9uKHZtLmNvdXJzZUNvZGUsIHZtLmFzc2lnbm1lbnRJRCwgdm0ucXVlc3Rpb24pLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpXHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5hZGRNQ0Fuc3dlciA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdGNvbnNvbGUubG9nKHZtLnF1ZXN0aW9uKTtcclxuXHRcdFx0dm0ucXVlc3Rpb24uYW5zd2VyT3B0aW9ucy5wdXNoKCcnKTtcclxuXHRcdH1cclxuXHR9XSlcclxuXHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKVxyXG5cdC5kaXJlY3RpdmUoJ3F1ZXN0aW9uJywgZnVuY3Rpb24oKXtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHJlc3RyaWN0OiAnRScsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvYXNzaWdubWVudHMvcGFydGlhbHMvcXVlc3Rpb24uaHRtbCcsXHJcblx0XHRcdGNvbnRyb2xsZXI6ICdRdWVzdGlvbkNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdxdWVzdGlvbkN0cmwnXHJcblx0XHR9XHJcblx0fSlcclxuXHQuZGlyZWN0aXZlKCdxdWVzdGlvbkVkaXQnLCBmdW5jdGlvbigpe1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzdHJpY3Q6ICdFJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9hc3NpZ25tZW50cy9wYXJ0aWFscy9xdWVzdGlvbkVkaXQuaHRtbCcsXHJcblx0XHRcdGNvbnRyb2xsZXI6ICdRdWVzdGlvbkVkaXRDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAncXVlc3Rpb25FZGl0Q3RybCdcclxuXHRcdH1cclxuXHR9KVxyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2Fzc2lnbm1lbnRzJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5hc3NpZ25tZW50Jywge1xyXG5cdFx0XHR1cmw6ICcvY291cnNlLzpjb3Vyc2VDb2RlL2Fzc2lnbm1lbnQvOmFzc2lnbm1lbnRJRCcsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvYXNzaWdubWVudHMvcGFydGlhbHMvYXNzaWdubWVudC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0Fzc2lnbm1lbnRDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnYXNzaWdubWVudEN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnYXNzaWdubWVudHMnKS5mYWN0b3J5KCdBc3NpZ25tZW50RmFjdG9yeScsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjcmVhdGVBc3NpZ25tZW50OiBjcmVhdGVBc3NpZ25tZW50LFxyXG5cdFx0XHRnZXRBc3NpZ25tZW50OiBnZXRBc3NpZ25tZW50LFxyXG5cdFx0XHRhZGRRdWVzdGlvbjogYWRkUXVlc3Rpb24sXHJcblx0XHRcdGRlbGV0ZVF1ZXN0aW9uOiBkZWxldGVRdWVzdGlvblxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBjcmVhdGVBc3NpZ25tZW50KGNvdXJzZUNvZGUsIG5ld0Fzc2lnbm1lbnQpe1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvY3JlYXRlJywgbmV3QXNzaWdubWVudCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldEFzc2lnbm1lbnQoY291cnNlQ29kZSwgYXNzaWdubWVudElEKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGFzc2lnbm1lbnQgPSByZXMuZGF0YTtcclxuXHRcdFx0XHRcdHZhciBlSSA9IDAsIHFJID0gMDtcclxuXHJcblx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnQgPSBuZXcgQXJyYXkoYXNzaWdubWVudC5xdWVzdGlvbnMubGVuZ3RoICsgYXNzaWdubWVudC5leGVyY2lzZXMubGVuZ3RoKTtcclxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGFzc2lnbm1lbnQpO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhc3NpZ25tZW50LmNvbnRlbnRPcmRlci5sZW5ndGg7IGkrKyl7XHJcblx0XHRcdFx0XHRcdC8vdHJ1ZSA9IGV4ZXJjaXNlLCBmYWxzZSA9IHF1ZXN0aW9uXHJcblx0XHRcdFx0XHRcdGlmIChhc3NpZ25tZW50LmNvbnRlbnRPcmRlcltpXSA9PT0gJ2V4ZXJjaXNlJyl7XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldID0gYXNzaWdubWVudC5leGVyY2lzZXNbZUldO1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXS50eXBlID0gJ2V4ZXJjaXNlJztcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0uZXhlcmNpc2VJbmRleCA9IGVJXHJcblx0XHRcdFx0XHRcdFx0ZUkrKztcclxuXHRcdFx0XHRcdFx0fWVsc2UgaWYgKGFzc2lnbm1lbnQuY29udGVudE9yZGVyW2ldID09PSAncXVlc3Rpb24nKXtcclxuXHRcdFx0XHRcdFx0XHRhc3NpZ25tZW50LmNvbnRlbnRbaV0gPSBhc3NpZ25tZW50LnF1ZXN0aW9uc1txSV07XHJcblx0XHRcdFx0XHRcdFx0YXNzaWdubWVudC5jb250ZW50W2ldLnR5cGUgPSAncXVlc3Rpb24nO1xyXG5cdFx0XHRcdFx0XHRcdGFzc2lnbm1lbnQuY29udGVudFtpXS5xdWVzdGlvbkluZGV4ID0gcUlcclxuXHRcdFx0XHRcdFx0XHRxSSsrXHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJldHVybiBhc3NpZ25tZW50O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gRmFpbHVyZShyZXMpe1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGFkZFF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS8nICsgY291cnNlQ29kZSArICcvYXNzaWdubWVudC8nICsgYXNzaWdubWVudElEICsgJy9xdWVzdGlvbi9jcmVhdGUnKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIFN1Y2Nlc3MocmVzKXtcclxuXHRcdFx0XHRcdHZhciBuZXdRdWVzdGlvbiA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdFx0bmV3UXVlc3Rpb24udHlwZSA9ICdxdWVzdGlvbic7XHJcblx0XHRcdFx0XHRyZXR1cm4gbmV3UXVlc3Rpb247XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGRlbGV0ZVF1ZXN0aW9uKGNvdXJzZUNvZGUsIGFzc2lnbm1lbnRJRCwgcXVlc3Rpb25JbmRleCl7XHJcblx0XHRcdHZhciBxdWVzdGlvbiA9IHsgcXVlc3Rpb25JbmRleDogcXVlc3Rpb25JbmRleCB9O1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCArICcvcXVlc3Rpb24vZGVsZXRlJywgcXVlc3Rpb24pO1xyXG5cdFx0fVxyXG5cdH1dKVxyXG5cclxuXHQuZmFjdG9yeSgnUXVlc3Rpb25GYWN0b3J5JywgW1wiJGh0dHBcIiwgZnVuY3Rpb24oJGh0dHApe1xyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGVkaXRRdWVzdGlvbjogZWRpdFF1ZXN0aW9uXHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGVkaXRRdWVzdGlvbihjb3Vyc2VDb2RlLCBhc3NpZ25tZW50SUQsIHF1ZXN0aW9uKXtcclxuXHRcdFx0cmV0dXJuICRodHRwLnB1dCgnL2FwaS9jb3Vyc2UvJyArIGNvdXJzZUNvZGUgKyAnL2Fzc2lnbm1lbnQvJyArIGFzc2lnbm1lbnRJRCArICcvcXVlc3Rpb24vZWRpdCcsIHF1ZXN0aW9uKTtcclxuXHRcdH1cclxuXHR9XSlcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIFtcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwiQ291cnNlRmFjdG9yeVwiLCBcIlVzZXJGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzdGF0ZSwgJGh0dHAsIENvdXJzZUZhY3RvcnksIFVzZXJGYWN0b3J5KXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR0aGlzLm5ld0NvdXJzZSA9IHt9O1xyXG5cdFx0dGhpcy5jb3Vyc2VzID0gbnVsbDtcclxuXHRcdHRoaXMudXNlciA9IFVzZXJGYWN0b3J5LmdldFVzZXIoKTtcclxuXHJcblx0XHR2YXIgZ2V0Q291cnNlcyA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdENvdXJzZUZhY3RvcnkuZ2V0Q291cnNlcygpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0dm0uY291cnNlcyA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmNyZWF0ZUNvdXJzZSA9IGZ1bmN0aW9uKCl7XHJcblx0XHRcdENvdXJzZUZhY3RvcnkuY3JlYXRlQ291cnNlKHZtLm5ld0NvdXJzZSkudGhlbihmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlcyk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGdldENvdXJzZXMoKTtcclxuXHR9XSk7XHJcblxyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29udHJvbGxlcignQ291cnNlQ29udHJvbGxlcicsIFxyXG5cdFx0W1wiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCJVc2VyRmFjdG9yeVwiLCBcIkNvdXJzZUZhY3RvcnlcIiwgXCJBc3NpZ25tZW50RmFjdG9yeVwiLCBmdW5jdGlvbigkc3RhdGUsICRodHRwLCAkc3RhdGVQYXJhbXMsIFVzZXJGYWN0b3J5LCBDb3Vyc2VGYWN0b3J5LCBBc3NpZ25tZW50RmFjdG9yeSl7XHJcblxyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmNvdXJzZSA9IG51bGw7XHJcblx0XHR0aGlzLnVzZXIgPSBVc2VyRmFjdG9yeS5nZXRVc2VyKCk7XHJcblx0XHR0aGlzLm5ld0Fzc2lnbm1lbnQgPSB7fTtcclxuXHJcblx0XHR2YXIgZ2V0Q291cnNlID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0Q291cnNlRmFjdG9yeS5nZXRDb3Vyc2UoJHN0YXRlUGFyYW1zLmNvdXJzZUNvZGUpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24gU3VjY2VzcyhyZXMpe1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcclxuXHRcdFx0XHRcdHZtLmNvdXJzZSA9IHJlcy5kYXRhO1xyXG5cdFx0XHRcdFx0dm0ubmV3QXNzaWdubWVudC5jb3Vyc2VJRCA9IHJlcy5kYXRhLl9pZDtcclxuXHRcdFx0XHR9LCBcclxuXHRcdFx0XHRmdW5jdGlvbiBGYWlsdXJlKHJlcyl7XHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0KTtcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5jcmVhdGVBc3NpZ25tZW50ID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0QXNzaWdubWVudEZhY3RvcnkuY3JlYXRlQXNzaWdubWVudCgkc3RhdGVQYXJhbXMuY291cnNlQ29kZSwgdm0ubmV3QXNzaWdubWVudCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiBTdWNjZXNzKHJlcyl7XHJcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXMpO1xyXG5cdFx0XHRcdH0sIFxyXG5cdFx0XHRcdGZ1bmN0aW9uIEZhaWx1cmUocmVzKXtcclxuXHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGdldENvdXJzZSgpO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5tYWluLmRhc2hib2FyZCcsIHtcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9jb3Vyc2VzL3BhcnRpYWxzL2Rhc2hib2FyZC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0Rhc2hib2FyZENvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdkYXNoYm9hcmRDdHJsJ1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3QuY291cnNlJywge1xyXG5cdFx0XHR1cmw6ICcvY291cnNlLzpjb3Vyc2VDb2RlJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci9jb3Vyc2VzL3BhcnRpYWxzL2NvdXJzZS5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0NvdXJzZUNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdjb3Vyc2VDdHJsJ1xyXG5cdFx0fSk7XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2NvdXJzZXMnKS5mYWN0b3J5KCdDb3Vyc2VGYWN0b3J5JywgW1wiJGh0dHBcIiwgZnVuY3Rpb24gKCRodHRwKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjcmVhdGVDb3Vyc2U6IGNyZWF0ZUNvdXJzZSxcclxuXHRcdFx0Z2V0Q291cnNlOiBnZXRDb3Vyc2UsXHJcblx0XHRcdGdldENvdXJzZXM6IGdldENvdXJzZXNcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBjcmVhdGVDb3Vyc2UobmV3Q291cnNlKSB7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS9jcmVhdGUnLCBuZXdDb3Vyc2UpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBnZXRDb3Vyc2UoY291cnNlQ29kZSl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvY291cnNlLycgKyBjb3Vyc2VDb2RlKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBnZXRDb3Vyc2VzKCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcHJvZmlsZS9jb3Vyc2VzJyk7XHJcblx0XHR9XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2dlbmVyYWwnKS5jb250cm9sbGVyKCdOYXZDb250cm9sbGVyJywgW1wiJGh0dHBcIiwgXCJBdXRoU2VydmljZVwiLCBcIkF1dGhSZXNvbHZlclwiLCBcIiRzdGF0ZVwiLCBmdW5jdGlvbigkaHR0cCwgQXV0aFNlcnZpY2UsIEF1dGhSZXNvbHZlciwgJHN0YXRlKXtcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR0aGlzLiRzdGF0ZSA9ICRzdGF0ZTtcclxuXHRcdHRoaXMuYkxvZ2dlZEluID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0aWYgKEF1dGhSZXNvbHZlci5iSXNSZXNvbHZlZCgpKXtcclxuXHRcdFx0dm0uYkxvZ2dlZEluID0gQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCk7XHJcblx0XHR9ZWxzZXtcclxuXHRcdFx0QXV0aFJlc29sdmVyLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0dm0uYkxvZ2dlZEluID0gQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdnZW5lcmFsJykuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHJcblx0XHQkc3RhdGVQcm92aWRlclxyXG5cdFx0LnN0YXRlKCdyb290Jywge1xyXG5cdFx0XHRhYnN0cmFjdDogdHJ1ZSxcclxuXHRcdFx0dGVtcGxhdGU6ICc8dWktdmlldy8+JyxcclxuXHRcdFx0cmVzb2x2ZToge1xyXG5cdFx0XHRcdGF1dGg6IFtcIkF1dGhSZXNvbHZlclwiLCBmdW5jdGlvbiByZXNvbHZlQXV0aGVudGljYXRpb24oQXV0aFJlc29sdmVyKSB7IFxyXG5cdFx0XHRcdFx0cmV0dXJuIChBdXRoUmVzb2x2ZXIuYklzUmVzb2x2ZWQoKSA9PT0gdHJ1ZSB8fCBBdXRoUmVzb2x2ZXIucmVzb2x2ZSgpKTtcclxuXHRcdFx0XHR9XVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cclxuXHRcdC5zdGF0ZSgncm9vdC5tYWluJywge1xyXG5cdFx0XHR1cmw6ICcvJyxcclxuXHRcdFx0dGVtcGxhdGU6ICc8dWktdmlldy8+JyxcclxuXHRcdFx0Y29udHJvbGxlcjogW1wiJHN0YXRlXCIsIFwiQXV0aFNlcnZpY2VcIiwgZnVuY3Rpb24oJHN0YXRlLCBBdXRoU2VydmljZSl7XHJcblx0XHRcdFx0aWYgKEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpKXtcclxuXHRcdFx0XHRcdCRzdGF0ZS5nbygncm9vdC5tYWluLmRhc2hib2FyZCcpO1xyXG5cdFx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4ucHVibGljJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XVxyXG5cdFx0fSlcclxuXHJcblx0XHQuc3RhdGUoJ3Jvb3QubWFpbi5wdWJsaWMnLCB7XHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvZ2VuZXJhbC9wYXJ0aWFscy9pbmRleC5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRjb25zb2xlLmxvZygnSGl0IHB1YmxpYyBpbmRleCcpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY2xpY2tPdXRzaWRlLiRpbmplY3QgPSBbXCIkZG9jdW1lbnRcIiwgXCIkcGFyc2VcIiwgXCIkdGltZW91dFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdtaXNjJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBjbGlja091dHNpZGUpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNsaWNrT3V0c2lkZSgkZG9jdW1lbnQsICRwYXJzZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW0sIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoaScpO1xyXG4gICAgICAgICAgICAgICAgLy8gcG9zdHBvbmUgbGlua2luZyB0byBuZXh0IGRpZ2VzdCB0byBhbGxvdyBmb3IgdW5pcXVlIGlkIGdlbmVyYXRpb25cclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc0xpc3QgPSAoYXR0ci5vdXRzaWRlSWZOb3QgIT09IHVuZGVmaW5lZCkgPyBhdHRyLm91dHNpZGVJZk5vdC5yZXBsYWNlKCcsICcsICcsJykuc3BsaXQoJywnKSA6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBlbGVtZW50cyBpZCBzbyBpdCBpcyBub3QgY291bnRlZCBpbiB0aGUgY2xpY2sgbGlzdGVuaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHIuaWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0xpc3QucHVzaChhdHRyLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGV2ZW50SGFuZGxlcihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBvdXIgZWxlbWVudCBhbHJlYWR5IGhpZGRlbiBhbmQgYWJvcnQgaWYgc29cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZWxlbWVudChlbGVtKS5oYXNDbGFzcyhcIm5nLWhpZGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGNsaWNrIHRhcmdldCwgbm8gcG9pbnQgZ29pbmcgb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlIHx8ICFlLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIGF2YWlsYWJsZSBlbGVtZW50cywgbG9va2luZyBmb3IgY2xhc3NlcyBpbiB0aGUgY2xhc3MgbGlzdCB0aGF0IG1pZ2h0IG1hdGNoIGFuZCBzbyB3aWxsIGVhdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGVsZW1lbnQgPSBlLnRhcmdldDsgZWxlbWVudDsgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gZWxlbWVudC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWVzID0gZWxlbWVudC5jbGFzc05hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGNsYXNzTGlzdC5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVW53cmFwIFNWR0FuaW1hdGVkU3RyaW5nIGNsYXNzZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWVzICYmIGNsYXNzTmFtZXMuYmFzZVZhbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXMuYmFzZVZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIGVsZW1lbnRzIGlkJ3MgYW5kIGNsYXNzbmFtZXMgbG9va2luZyBmb3IgZXhjZXB0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBleGFjdCBtYXRjaGVzIG9uIGlkJ3Mgb3IgY2xhc3NlcywgYnV0IG9ubHkgaWYgdGhleSBleGlzdCBpbiB0aGUgZmlyc3QgcGxhY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlkICE9PSB1bmRlZmluZWQgJiYgaWQgPT09IGNsYXNzTGlzdFtpXSkgfHwgKGNsYXNzTmFtZXMgJiYgY2xhc3NOYW1lcyA9PT0gY2xhc3NMaXN0W2ldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3cgbGV0J3MgZXhpdCBvdXQgYXMgaXQgaXMgYW4gZWxlbWVudCB0aGF0IGhhcyBiZWVuIGRlZmluZWQgYXMgYmVpbmcgaWdub3JlZCBmb3IgY2xpY2tpbmcgb3V0c2lkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGdvdCB0aGlzIGZhciwgdGhlbiB3ZSBhcmUgZ29vZCB0byBnbyB3aXRoIHByb2Nlc3NpbmcgdGhlIGNvbW1hbmQgcGFzc2VkIGluIHZpYSB0aGUgY2xpY2stb3V0c2lkZSBhdHRyaWJ1dGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbiA9ICRwYXJzZShhdHRyWydjbGlja091dHNpZGUnXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4oJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGV2aWNlcyBoYXMgYSB0b3VjaHNjcmVlbiwgbGlzdGVuIGZvciB0aGlzIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9oYXNUb3VjaCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRkb2N1bWVudC5vbigndG91Y2hzdGFydCcsIGV2ZW50SGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzdGlsbCBsaXN0ZW4gZm9yIHRoZSBjbGljayBldmVudCBldmVuIGlmIHRoZXJlIGlzIHRvdWNoIHRvIGNhdGVyIGZvciB0b3VjaHNjcmVlbiBsYXB0b3BzXHJcbiAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9uKCdjbGljaycsIGV2ZW50SGFuZGxlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIHNjb3BlIGlzIGRlc3Ryb3llZCwgY2xlYW4gdXAgdGhlIGRvY3VtZW50cyBldmVudCBoYW5kbGVycyBhcyB3ZSBkb24ndCB3YW50IGl0IGhhbmdpbmcgYXJvdW5kXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9oYXNUb3VjaCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jdW1lbnQub2ZmKCd0b3VjaHN0YXJ0JywgZXZlbnRIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9mZignY2xpY2snLCBldmVudEhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBwcml2YXRlIGZ1bmN0aW9uIHRvIGF0dGVtcHQgdG8gZmlndXJlIG91dCBpZiB3ZSBhcmUgb24gYSB0b3VjaCBkZXZpY2VcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBfaGFzVG91Y2goKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdvcmtzIG9uIG1vc3QgYnJvd3NlcnMsIElFMTAvMTEgYW5kIFN1cmZhY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyB8fCBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcblxuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiQXV0aFNlcnZpY2VcIiwgZnVuY3Rpb24oJHN0YXRlLCAkcm9vdFNjb3BlLCBBdXRoU2VydmljZSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0XHJcblx0XHR0aGlzLmF1dGhNZXNzYWdlID0gJyc7XHJcblx0XHR0aGlzLnVzZXIgPSB7XHJcblx0XHRcdGVtYWlsOiAnJyxcclxuXHRcdFx0cGFzc3dvcmQ6ICcnXHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMubG9naW4gPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0QXV0aFNlcnZpY2UubG9naW4ocm9vdC51c2VyKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbicpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRcdHZtLmF1dGhNZXNzYWdlID0gcmVzLmRhdGEudXNlck1lc3NhZ2U7XHJcblx0XHRcdFx0fSk7XHJcblx0XHR9O1xyXG5cdH1dKTtcclxuXHRcclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ0pvaW5Db250cm9sbGVyJywgW1wiJHN0YXRlXCIsIFwiJHJvb3RTY29wZVwiLCBcIkF1dGhTZXJ2aWNlXCIsIGZ1bmN0aW9uKCRzdGF0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2Upe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdHRoaXMuYXV0aE1lc3NhZ2UgPSAnJztcclxuXHRcdHRoaXMudXNlciA9IHtcclxuXHRcdFx0Zmlyc3ROYW1lOiAnJyxcclxuXHRcdFx0bGFzdE5hbWU6ICcnLFxyXG5cdFx0XHRyZXR5cGVQYXNzd29yZDogJycsIFxyXG5cdFx0XHRwYXNzd29yZDogJycsXHJcblx0XHRcdGVtYWlsOiAnJyxcclxuXHRcdFx0YWNjb3VudFR5cGU6ICcnXHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuc2lnbnVwID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdEF1dGhTZXJ2aWNlLnNpZ251cChyb290LnVzZXIpLnRoZW4oXHJcblx0XHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRcdCRzdGF0ZS5nbygncm9vdC5tYWluJyk7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdFx0dm0uYXV0aE1lc3NhZ2UgPSByZXMuZGF0YS51c2VyTWVzc2FnZTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdH07XHJcblx0fV0pO1xyXG5cclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgW1wiJHN0YXRlXCIsIFwiVXNlckZhY3RvcnlcIiwgZnVuY3Rpb24oJHN0YXRlLCBVc2VyRmFjdG9yeSl7XHJcblx0XHR0aGlzLnVzZXIgPSBVc2VyRmFjdG9yeS5nZXRVc2VyKCk7XHJcblx0fV0pO1xyXG59KSgpO1xuKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHRcdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdyb290LmxvZ2luJywge1xyXG5cdFx0XHR1cmw6ICcvbG9naW4nLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvbG9naW4uaHRtbCcsXHJcblx0XHRcdGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdsb2dpbkN0cmwnXHJcblx0XHR9KTtcclxuXHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5qb2luJywge1xyXG5cdFx0XHR1cmw6ICcvam9pbicsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvdXNlci9wYXJ0aWFscy9qb2luLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnSm9pbkNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdqb2luQ3RybCdcclxuXHRcdH0pO1xyXG5cdFx0XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5wcm9maWxlJywge1xyXG5cdFx0XHR1cmw6ICcvcHJvZmlsZScsXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXIvdXNlci9wYXJ0aWFscy9wcm9maWxlLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXInLFxyXG5cdFx0XHRjb250cm9sbGVyQXM6ICdwcm9maWxlQ3RybCdcclxuXHRcdH0pO1xyXG5cdH1dKTtcclxufSkoKTtcbihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBbXCIkaHR0cFwiLCBcIlVzZXJGYWN0b3J5XCIsIGZ1bmN0aW9uICgkaHR0cCwgVXNlckZhY3RvcnkpIHtcclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRsb2dpbjogbG9naW4sXHJcblx0XHRcdHNpZ251cDogc2lnbnVwLFxyXG5cdFx0XHRpc0F1dGhlbnRpY2F0ZWQ6IGlzQXV0aGVudGljYXRlZFxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBsb2dpbihjcmVkZW50aWFscykge1xyXG5cdFx0XHRyZXR1cm4gJGh0dHBcclxuXHRcdFx0LnBvc3QoJy9hdXRoL2xvY2FsJywgY3JlZGVudGlhbHMpXHJcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuXHRcdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHJlcy5kYXRhKTtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XHJcblx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBzaWdudXAobmV3VXNlcil7XHJcblx0XHRcdHJldHVybiAkaHR0cFxyXG5cdFx0XHQucG9zdCgnL2FwaS91c2VyL2pvaW4nLCBuZXdVc2VyKVxyXG5cdFx0XHQudGhlbihcclxuXHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHJlcy5kYXRhKTtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XHJcblx0XHRcdH0sIGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xyXG5cdFx0XHR9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gaXNBdXRoZW50aWNhdGVkKCl7XHJcblx0XHRcdHJldHVybiBVc2VyRmFjdG9yeS5saXZlKCk7XHJcblx0XHR9O1xyXG5cdH1dKTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5mYWN0b3J5KCdVc2VyRmFjdG9yeScsIFtcIiRyb290U2NvcGVcIiwgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGxpdmU6IGxpdmUsXHJcblx0XHRcdHNldFVzZXI6IHNldFVzZXIsXHJcblx0XHRcdGdldFVzZXI6IGdldFVzZXIsXHJcblx0XHRcdGRlc3Ryb3lVc2VyOiBkZXN0cm95VXNlclxyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGxpdmUoKXtcclxuXHRcdFx0cmV0dXJuIChPYmplY3Qua2V5cygkcm9vdFNjb3BlLmN1cnJlbnRVc2VyKS5sZW5ndGggPiAwKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBzZXRVc2VyKHVzZXIpe1xyXG5cdFx0XHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0VXNlcigpe1xyXG5cdFx0XHRyZXR1cm4gJHJvb3RTY29wZS5jdXJyZW50VXNlcjtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBkZXN0cm95VXNlcigpe1xyXG5cdFx0XHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcclxuXHRcdH07XHJcblx0fV0pO1xyXG5cclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmZhY3RvcnkoJ0F1dGhSZXNvbHZlcicsIFtcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBmdW5jdGlvbigkcSwgJHJvb3RTY29wZSwgJHN0YXRlKSB7XHJcblx0XHR2YXIgYklzUmVzb2x2ZWQgPSBmYWxzZTtcclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRyZXNvbHZlOiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdFx0XHR2YXIgdW53YXRjaCA9ICRyb290U2NvcGUuJHdhdGNoKCdjdXJyZW50VXNlcicsIGZ1bmN0aW9uIChjdXJyZW50VXNlcikge1xyXG5cdFx0XHRcdFx0aWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGN1cnJlbnRVc2VyKSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoY3VycmVudFVzZXIpIHtcclxuXHRcdFx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGN1cnJlbnRVc2VyKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRiSXNSZXNvbHZlZCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdHVud2F0Y2goKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGJJc1Jlc29sdmVkOiBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdHJldHVybiBiSXNSZXNvbHZlZDtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9XSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKXtcclxuXHRcdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdyb290Lm1haW4uZGFzaGJvYXJkJywge1xyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2NvdXJzZXMvcGFydGlhbHMvZGFzaGJvYXJkLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnRGFzaGJvYXJkQ29udHJvbGxlcicsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ2Rhc2hib2FyZEN0cmwnXHJcblx0XHR9KTtcclxuXHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5jb3Vyc2UnLCB7XHJcblx0XHRcdHVybDogJy9jb3Vyc2UvOmNvdXJzZUNvZGUnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2NvdXJzZXMvcGFydGlhbHMvY291cnNlLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnQ291cnNlQ29udHJvbGxlcicsXHJcblx0XHRcdGNvbnRyb2xsZXJBczogJ2NvdXJzZUN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2NvdXJzZXMnKS5mYWN0b3J5KCdDb3Vyc2VGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjcmVhdGVDb3Vyc2U6IGNyZWF0ZUNvdXJzZSxcclxuXHRcdFx0Z2V0Q291cnNlOiBnZXRDb3Vyc2UsXHJcblx0XHRcdGdldENvdXJzZXM6IGdldENvdXJzZXNcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBjcmVhdGVDb3Vyc2UobmV3Q291cnNlKSB7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2NvdXJzZS9jcmVhdGUnLCBuZXdDb3Vyc2UpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBnZXRDb3Vyc2UoY291cnNlQ29kZSl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvY291cnNlLycgKyBjb3Vyc2VDb2RlKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBnZXRDb3Vyc2VzKCl7XHJcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcHJvZmlsZS9jb3Vyc2VzJyk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ2dlbmVyYWwnKS5jb250cm9sbGVyKCdOYXZDb250cm9sbGVyJywgZnVuY3Rpb24oJGh0dHAsIEF1dGhTZXJ2aWNlLCBBdXRoUmVzb2x2ZXIsICRzdGF0ZSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dGhpcy4kc3RhdGUgPSAkc3RhdGU7XHJcblx0XHR0aGlzLmJMb2dnZWRJbiA9IG51bGw7XHJcblx0XHRcclxuXHRcdGlmIChBdXRoUmVzb2x2ZXIuYklzUmVzb2x2ZWQoKSl7XHJcblx0XHRcdHZtLmJMb2dnZWRJbiA9IEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdEF1dGhSZXNvbHZlci5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpe1xyXG5cdFx0XHRcdHZtLmJMb2dnZWRJbiA9IEF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgnZ2VuZXJhbCcpLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblxyXG5cdFx0JHN0YXRlUHJvdmlkZXJcclxuXHRcdC5zdGF0ZSgncm9vdCcsIHtcclxuXHRcdFx0YWJzdHJhY3Q6IHRydWUsXHJcblx0XHRcdHRlbXBsYXRlOiAnPHVpLXZpZXcvPicsXHJcblx0XHRcdHJlc29sdmU6IHtcclxuXHRcdFx0XHRhdXRoOiBmdW5jdGlvbiByZXNvbHZlQXV0aGVudGljYXRpb24oQXV0aFJlc29sdmVyKSB7IFxyXG5cdFx0XHRcdFx0cmV0dXJuIChBdXRoUmVzb2x2ZXIuYklzUmVzb2x2ZWQoKSA9PT0gdHJ1ZSB8fCBBdXRoUmVzb2x2ZXIucmVzb2x2ZSgpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0LnN0YXRlKCdyb290Lm1haW4nLCB7XHJcblx0XHRcdHVybDogJy8nLFxyXG5cdFx0XHR0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nLFxyXG5cdFx0XHRjb250cm9sbGVyOiBmdW5jdGlvbigkc3RhdGUsIEF1dGhTZXJ2aWNlKXtcclxuXHRcdFx0XHRpZiAoQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpe1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4uZGFzaGJvYXJkJyk7XHJcblx0XHRcdFx0fWVsc2V7XHJcblx0XHRcdFx0XHQkc3RhdGUuZ28oJ3Jvb3QubWFpbi5wdWJsaWMnKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0LnN0YXRlKCdyb290Lm1haW4ucHVibGljJywge1xyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL2dlbmVyYWwvcGFydGlhbHMvaW5kZXguaHRtbCcsXHJcblx0XHRcdGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coJ0hpdCBwdWJsaWMgaW5kZXgnKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdtaXNjJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBjbGlja091dHNpZGUpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNsaWNrT3V0c2lkZSgkZG9jdW1lbnQsICRwYXJzZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW0sIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoaScpO1xyXG4gICAgICAgICAgICAgICAgLy8gcG9zdHBvbmUgbGlua2luZyB0byBuZXh0IGRpZ2VzdCB0byBhbGxvdyBmb3IgdW5pcXVlIGlkIGdlbmVyYXRpb25cclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc0xpc3QgPSAoYXR0ci5vdXRzaWRlSWZOb3QgIT09IHVuZGVmaW5lZCkgPyBhdHRyLm91dHNpZGVJZk5vdC5yZXBsYWNlKCcsICcsICcsJykuc3BsaXQoJywnKSA6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBlbGVtZW50cyBpZCBzbyBpdCBpcyBub3QgY291bnRlZCBpbiB0aGUgY2xpY2sgbGlzdGVuaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHIuaWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc0xpc3QucHVzaChhdHRyLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGV2ZW50SGFuZGxlcihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBvdXIgZWxlbWVudCBhbHJlYWR5IGhpZGRlbiBhbmQgYWJvcnQgaWYgc29cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZWxlbWVudChlbGVtKS5oYXNDbGFzcyhcIm5nLWhpZGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGNsaWNrIHRhcmdldCwgbm8gcG9pbnQgZ29pbmcgb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlIHx8ICFlLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIGF2YWlsYWJsZSBlbGVtZW50cywgbG9va2luZyBmb3IgY2xhc3NlcyBpbiB0aGUgY2xhc3MgbGlzdCB0aGF0IG1pZ2h0IG1hdGNoIGFuZCBzbyB3aWxsIGVhdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGVsZW1lbnQgPSBlLnRhcmdldDsgZWxlbWVudDsgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gZWxlbWVudC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWVzID0gZWxlbWVudC5jbGFzc05hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCA9IGNsYXNzTGlzdC5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVW53cmFwIFNWR0FuaW1hdGVkU3RyaW5nIGNsYXNzZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWVzICYmIGNsYXNzTmFtZXMuYmFzZVZhbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXMuYmFzZVZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIGVsZW1lbnRzIGlkJ3MgYW5kIGNsYXNzbmFtZXMgbG9va2luZyBmb3IgZXhjZXB0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBleGFjdCBtYXRjaGVzIG9uIGlkJ3Mgb3IgY2xhc3NlcywgYnV0IG9ubHkgaWYgdGhleSBleGlzdCBpbiB0aGUgZmlyc3QgcGxhY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlkICE9PSB1bmRlZmluZWQgJiYgaWQgPT09IGNsYXNzTGlzdFtpXSkgfHwgKGNsYXNzTmFtZXMgJiYgY2xhc3NOYW1lcyA9PT0gY2xhc3NMaXN0W2ldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3cgbGV0J3MgZXhpdCBvdXQgYXMgaXQgaXMgYW4gZWxlbWVudCB0aGF0IGhhcyBiZWVuIGRlZmluZWQgYXMgYmVpbmcgaWdub3JlZCBmb3IgY2xpY2tpbmcgb3V0c2lkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGdvdCB0aGlzIGZhciwgdGhlbiB3ZSBhcmUgZ29vZCB0byBnbyB3aXRoIHByb2Nlc3NpbmcgdGhlIGNvbW1hbmQgcGFzc2VkIGluIHZpYSB0aGUgY2xpY2stb3V0c2lkZSBhdHRyaWJ1dGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbiA9ICRwYXJzZShhdHRyWydjbGlja091dHNpZGUnXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4oJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGV2aWNlcyBoYXMgYSB0b3VjaHNjcmVlbiwgbGlzdGVuIGZvciB0aGlzIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9oYXNUb3VjaCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRkb2N1bWVudC5vbigndG91Y2hzdGFydCcsIGV2ZW50SGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzdGlsbCBsaXN0ZW4gZm9yIHRoZSBjbGljayBldmVudCBldmVuIGlmIHRoZXJlIGlzIHRvdWNoIHRvIGNhdGVyIGZvciB0b3VjaHNjcmVlbiBsYXB0b3BzXHJcbiAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9uKCdjbGljaycsIGV2ZW50SGFuZGxlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIHNjb3BlIGlzIGRlc3Ryb3llZCwgY2xlYW4gdXAgdGhlIGRvY3VtZW50cyBldmVudCBoYW5kbGVycyBhcyB3ZSBkb24ndCB3YW50IGl0IGhhbmdpbmcgYXJvdW5kXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9oYXNUb3VjaCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jdW1lbnQub2ZmKCd0b3VjaHN0YXJ0JywgZXZlbnRIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9mZignY2xpY2snLCBldmVudEhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBwcml2YXRlIGZ1bmN0aW9uIHRvIGF0dGVtcHQgdG8gZmlndXJlIG91dCBpZiB3ZSBhcmUgb24gYSB0b3VjaCBkZXZpY2VcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBfaGFzVG91Y2goKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdvcmtzIG9uIG1vc3QgYnJvd3NlcnMsIElFMTAvMTEgYW5kIFN1cmZhY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyB8fCBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24oKXtcclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzdGF0ZSwgJHJvb3RTY29wZSwgQXV0aFNlcnZpY2Upe1xyXG5cdFx0dmFyIHZtID0gdGhpcztcclxuXHRcdFxyXG5cdFx0dGhpcy5hdXRoTWVzc2FnZSA9ICcnO1xyXG5cdFx0dGhpcy51c2VyID0ge1xyXG5cdFx0XHRlbWFpbDogJycsXHJcblx0XHRcdHBhc3N3b3JkOiAnJ1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmxvZ2luID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdEF1dGhTZXJ2aWNlLmxvZ2luKHJvb3QudXNlcikudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4nKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHR2bS5hdXRoTWVzc2FnZSA9IHJlcy5kYXRhLnVzZXJNZXNzYWdlO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHR9KTtcclxuXHRcclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmNvbnRyb2xsZXIoJ0pvaW5Db250cm9sbGVyJywgZnVuY3Rpb24oJHN0YXRlLCAkcm9vdFNjb3BlLCBBdXRoU2VydmljZSl7XHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dGhpcy5hdXRoTWVzc2FnZSA9ICcnO1xyXG5cdFx0dGhpcy51c2VyID0ge1xyXG5cdFx0XHRmaXJzdE5hbWU6ICcnLFxyXG5cdFx0XHRsYXN0TmFtZTogJycsXHJcblx0XHRcdHJldHlwZVBhc3N3b3JkOiAnJywgXHJcblx0XHRcdHBhc3N3b3JkOiAnJyxcclxuXHRcdFx0ZW1haWw6ICcnLFxyXG5cdFx0XHRhY2NvdW50VHlwZTogJydcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5zaWdudXAgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0QXV0aFNlcnZpY2Uuc2lnbnVwKHJvb3QudXNlcikudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbihyZXMpe1xyXG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdyb290Lm1haW4nKTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0XHR2bS5hdXRoTWVzc2FnZSA9IHJlcy5kYXRhLnVzZXJNZXNzYWdlO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHR9KTtcclxuXHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzdGF0ZSwgVXNlckZhY3Rvcnkpe1xyXG5cdFx0dGhpcy51c2VyID0gVXNlckZhY3RvcnkuZ2V0VXNlcigpO1xyXG5cdH0pO1xyXG59KSgpOyIsIihmdW5jdGlvbigpe1xyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcil7XHJcblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgncm9vdC5sb2dpbicsIHtcclxuXHRcdFx0dXJsOiAnL2xvZ2luJyxcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvYW5ndWxhci91c2VyL3BhcnRpYWxzL2xvZ2luLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnbG9naW5DdHJsJ1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3Quam9pbicsIHtcclxuXHRcdFx0dXJsOiAnL2pvaW4nLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvam9pbi5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ0pvaW5Db250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAnam9pbkN0cmwnXHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Jvb3QucHJvZmlsZScsIHtcclxuXHRcdFx0dXJsOiAnL3Byb2ZpbGUnLFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy9hbmd1bGFyL3VzZXIvcGFydGlhbHMvcHJvZmlsZS5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcclxuXHRcdFx0Y29udHJvbGxlckFzOiAncHJvZmlsZUN0cmwnXHJcblx0XHR9KTtcclxuXHR9XSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3VzZXInKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgVXNlckZhY3RvcnkpIHtcclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRsb2dpbjogbG9naW4sXHJcblx0XHRcdHNpZ251cDogc2lnbnVwLFxyXG5cdFx0XHRpc0F1dGhlbnRpY2F0ZWQ6IGlzQXV0aGVudGljYXRlZFxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBsb2dpbihjcmVkZW50aWFscykge1xyXG5cdFx0XHRyZXR1cm4gJGh0dHBcclxuXHRcdFx0LnBvc3QoJy9hdXRoL2xvY2FsJywgY3JlZGVudGlhbHMpXHJcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuXHRcdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHJlcy5kYXRhKTtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XHJcblx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBzaWdudXAobmV3VXNlcil7XHJcblx0XHRcdHJldHVybiAkaHR0cFxyXG5cdFx0XHQucG9zdCgnL2FwaS91c2VyL2pvaW4nLCBuZXdVc2VyKVxyXG5cdFx0XHQudGhlbihcclxuXHRcdFx0ZnVuY3Rpb24ocmVzKXtcclxuXHRcdFx0XHRVc2VyRmFjdG9yeS5zZXRVc2VyKHJlcy5kYXRhKTtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XHJcblx0XHRcdH0sIGZ1bmN0aW9uKHJlcyl7XHJcblx0XHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xyXG5cdFx0XHR9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gaXNBdXRoZW50aWNhdGVkKCl7XHJcblx0XHRcdHJldHVybiBVc2VyRmFjdG9yeS5saXZlKCk7XHJcblx0XHR9O1xyXG5cdH0pO1xyXG5cclxuXHRhbmd1bGFyLm1vZHVsZSgndXNlcicpLmZhY3RvcnkoJ1VzZXJGYWN0b3J5JywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGxpdmU6IGxpdmUsXHJcblx0XHRcdHNldFVzZXI6IHNldFVzZXIsXHJcblx0XHRcdGdldFVzZXI6IGdldFVzZXIsXHJcblx0XHRcdGRlc3Ryb3lVc2VyOiBkZXN0cm95VXNlclxyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGxpdmUoKXtcclxuXHRcdFx0cmV0dXJuIChPYmplY3Qua2V5cygkcm9vdFNjb3BlLmN1cnJlbnRVc2VyKS5sZW5ndGggPiAwKTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBzZXRVc2VyKHVzZXIpe1xyXG5cdFx0XHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuXHRcdH07XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0VXNlcigpe1xyXG5cdFx0XHRyZXR1cm4gJHJvb3RTY29wZS5jdXJyZW50VXNlcjtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBkZXN0cm95VXNlcigpe1xyXG5cdFx0XHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcclxuXHRcdH07XHJcblx0fSk7XHJcblxyXG5cdGFuZ3VsYXIubW9kdWxlKCd1c2VyJykuZmFjdG9yeSgnQXV0aFJlc29sdmVyJywgZnVuY3Rpb24oJHEsICRyb290U2NvcGUsICRzdGF0ZSkge1xyXG5cdFx0dmFyIGJJc1Jlc29sdmVkID0gZmFsc2U7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzb2x2ZTogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblx0XHRcdFx0dmFyIHVud2F0Y2ggPSAkcm9vdFNjb3BlLiR3YXRjaCgnY3VycmVudFVzZXInLCBmdW5jdGlvbiAoY3VycmVudFVzZXIpIHtcclxuXHRcdFx0XHRcdGlmIChhbmd1bGFyLmlzRGVmaW5lZChjdXJyZW50VXNlcikpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGN1cnJlbnRVc2VyKSB7XHJcblx0XHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShjdXJyZW50VXNlcik7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0YklzUmVzb2x2ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHR1bndhdGNoKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblx0XHRcdH0sXHJcblxyXG5cdFx0XHRiSXNSZXNvbHZlZDogZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRyZXR1cm4gYklzUmVzb2x2ZWQ7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0fSk7XHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
